/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  LIRPSuggestModal: () => LIRPSuggestModal,
  default: () => ListItemRandomPicker
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
function findIndexes(anArray, predicate) {
  const indexes = [];
  anArray.forEach((element, index) => {
    if (predicate(element, index)) {
      indexes.push(index);
    }
  });
  return indexes;
}
var DEFAULT_SETTINGS = {
  notePath: "Full path of a note",
  showWarning: true
};
var LIRPList = class {
  constructor(lines) {
    this.title = "";
    this.description = "";
    this.hidden = false;
    this.items = [];
    this.warning = [];
    const headingRegEx = /^# +(.+)$/;
    this.title = lines[0].replace(headingRegEx, "$1");
    const italicHeadingRegex = /^(_|\*)\S/;
    if (italicHeadingRegex.test(this.title)) {
      this.hidden = true;
    } else {
      this.hidden = false;
    }
    lines.shift();
    const listBeginItemRegex = /^(-|\d+\.) +(.+)$/;
    const listBeginIndexes = findIndexes(lines, (element) => listBeginItemRegex.test(element));
    if (listBeginIndexes.length === 0) {
      this.warning.push(`No items in list ${this.title}`);
      this.hidden = true;
      return;
    }
    const cleanLines = lines.map((element) => {
      return element.replace(listBeginItemRegex, "$2");
    });
    if (listBeginIndexes[0] !== 0) {
      let mdDescription = cleanLines.slice(0, listBeginIndexes[0]);
      if (mdDescription[0] === "") {
        mdDescription.shift();
      }
      this.description = mdDescription.join("\n");
    } else {
      this.description = "";
    }
    const listBeginCount = listBeginIndexes.length;
    let item;
    for (let currentIndex = 0; currentIndex < listBeginCount - 1; currentIndex++) {
      item = cleanLines.slice(listBeginIndexes[currentIndex], listBeginIndexes[currentIndex + 1]);
      this.pushItemBasedOnWeight(item);
    }
    item = cleanLines.slice(listBeginIndexes[listBeginCount - 1]);
    if (item.at(-1) === "") {
      item.pop();
    }
    this.pushItemBasedOnWeight(item);
  }
  pushItemBasedOnWeight(item) {
    const ItemWithWeightRegEx = /^\((\d+)\)\s+(.+)$/;
    let regExExecution;
    let repeat;
    if ((regExExecution = ItemWithWeightRegEx.exec(item[0])) !== null) {
      repeat = Number(regExExecution[1]);
      item[0] = regExExecution[2];
    } else {
      repeat = 1;
    }
    const stringItem = item.join("\n");
    for (let i = 0; i < repeat; i++) {
      this.items.push(stringItem);
    }
  }
  getListSuggestion() {
    const suggestion = {
      title: this.title,
      description: this.description.split("\n")[0]
    };
    return suggestion;
  }
  notHidden() {
    return !this.hidden;
  }
  pickRandomItem() {
    let randomItem = "";
    if (this.items.length > 0) {
      randomItem = this.items[Math.floor(Math.random() * this.items.length)];
    }
    return randomItem;
  }
  getWarning() {
    return this.warning;
  }
};
var LIRPNote = class {
  constructor() {
    this.noteName = "";
    this.description = "";
    this.list = [];
    this.error = [];
    this.warning = [];
  }
  loadFromNote(noteName, noteContent) {
    this.noteName = noteName;
    const lines = noteContent.split("\n");
    const headingRegex = /^# .+$/;
    let headingIndexes = findIndexes(lines, (element) => headingRegex.test(element));
    if (headingIndexes.length === 0) {
      this.error.push(`No heading in note`);
      return false;
    }
    if (headingIndexes[0] !== 0) {
      this.description = lines.slice(0, headingIndexes[0]).join("\n");
    }
    headingIndexes = findIndexes(lines, (element) => headingRegex.test(element));
    const headingCount = headingIndexes.length;
    for (let currentIndex = headingIndexes[0]; currentIndex < headingCount - 1; currentIndex++) {
      this.list.push(new LIRPList(lines.slice(headingIndexes[currentIndex], headingIndexes[currentIndex + 1])));
    }
    this.list.push(new LIRPList(lines.slice(headingIndexes[headingCount - 1])));
    return true;
  }
  getNoteSuggestion() {
    let noteSuggestion;
    noteSuggestion = [];
    this.list.forEach((element) => {
      if (element.notHidden()) {
        noteSuggestion.push(element.getListSuggestion());
      }
    });
    return noteSuggestion;
  }
  execMacroSubstitution(item, macroRecursion = 1) {
    const currentMacroRecusion = macroRecursion - 1;
    let modifiedItem = item;
    this.list.forEach((element) => {
      const stringTitleRegex = `{(${element.title})}`;
      const titleRegex = new RegExp(stringTitleRegex, "m");
      while (titleRegex.test(modifiedItem)) {
        const execTitleRegex = titleRegex.exec(modifiedItem);
        if (execTitleRegex !== null) {
          const listTitle = execTitleRegex[1];
          modifiedItem = modifiedItem.replace(titleRegex, this.pickRandomItemFromList(listTitle, currentMacroRecusion));
        }
      }
    });
    return modifiedItem;
  }
  pickRandomItemFromList(listTitle, macroRecursion = 1) {
    let randomItem = "";
    const currentList = this.list.find((element) => element.title === listTitle);
    if (currentList !== void 0) {
      randomItem = currentList.pickRandomItem();
      for (let repeat = 0; repeat < macroRecursion; repeat++) {
        randomItem = this.execMacroSubstitution(randomItem);
      }
    }
    return randomItem;
  }
  getError() {
    return this.error;
  }
  getWarning() {
    let allWarning;
    allWarning = [];
    allWarning = allWarning.concat(this.warning);
    this.list.forEach((element) => {
      allWarning = allWarning.concat(element.getWarning());
    });
    let NoteWarning;
    NoteWarning = [];
    allWarning.forEach(
      (element) => NoteWarning.push(`Warning in note "${this.noteName}" : ${element}`)
    );
    return NoteWarning;
  }
};
var LIRPSuggestModal = class extends import_obsidian.SuggestModal {
  constructor(app, items, callback) {
    super(app);
    this.items = items;
    this.callback = callback;
  }
  getSuggestions(query) {
    return this.items.filter(
      (item) => item.title.toLowerCase().includes(query.toLowerCase())
    );
  }
  renderSuggestion(item, el) {
    el.createEl("div", { text: item.title });
    el.createEl("small", { text: item.description });
  }
  onChooseSuggestion(item, evt) {
    this.callback(item.title);
  }
};
var ListItemRandomPicker = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("list-tree", "Pick random list item", (evt) => {
      this.doTheJob(this.settings.notePath + ".md");
    });
    this.addCommand({
      id: "insert-random-item",
      name: "Insert random item from list",
      callback: () => {
        this.doTheJob(this.settings.notePath + ".md");
      }
    });
    this.addSettingTab(new LIRPSettingTab(this.app, this));
  }
  onunload() {
  }
  async doTheJob(fullNotePath) {
    const file = this.app.vault.getAbstractFileByPath(fullNotePath);
    if (!file) {
      new import_obsidian.Notice("Note not found!");
      return;
    }
    if (!(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice("Invalid file type. Expected a Markdown note file.");
      return;
    }
    const content = await this.app.vault.cachedRead(file);
    const currentLIRP = new LIRPNote();
    const loadSuccess = currentLIRP.loadFromNote(this.settings.notePath, content);
    if (!loadSuccess) {
      currentLIRP.getError().forEach((element) => new import_obsidian.Notice(element));
      return;
    }
    if (this.settings.showWarning) {
      currentLIRP.getWarning().forEach((element) => {
        new import_obsidian.Notice(element);
      });
    }
    ;
    new LIRPSuggestModal(this.app, currentLIRP.getNoteSuggestion(), (title) => {
      this.insertString(currentLIRP.pickRandomItemFromList(title));
    }).open();
  }
  insertString(currentString) {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (activeView) {
      const editor = activeView.editor;
      const selection = editor.getSelection();
      editor.replaceSelection(currentString);
    } else {
      new import_obsidian.Notice("No active Markdown editor found.");
    }
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var LIRPSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Note Path").setDesc("Path to the note containing the lists.").addText(
      (text) => text.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async (value) => {
        this.plugin.settings.notePath = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("Show warning").setDesc("Show warnings of Note and lists, if present.").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.showWarning);
      toggle.onChange(async (value) => {
        this.plugin.settings.showWarning = value;
        await this.plugin.saveSettings();
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgaXQgfSBmcm9tICdub2RlOnRlc3QnO1xuaW1wb3J0IHsgQXBwLCBNb2RhbCwgU3VnZ2VzdE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcblxuZnVuY3Rpb24gZmluZEluZGV4ZXM8VD4oYW5BcnJheTogVFtdLCBwcmVkaWNhdGU6IChlbGVtZW50OiBULCBpbmRleDogbnVtYmVyKSA9PiBib29sZWFuKTogbnVtYmVyW10ge1xuICAgIGNvbnN0IGluZGV4ZXM6IG51bWJlcltdID0gW107XG4gICAgYW5BcnJheS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHByZWRpY2F0ZShlbGVtZW50LCBpbmRleCkpIHtcbiAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaW5kZXhlcztcbiAgfVxuaW50ZXJmYWNlIExJUlBQbHVnaW5TZXR0aW5ncyB7XG4gICAgbm90ZVBhdGg6IHN0cmluZztcbiAgICBzaG93V2FybmluZzogYm9vbGVhbjtcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTElSUFBsdWdpblNldHRpbmdzID0ge1xuICAgIG5vdGVQYXRoOiAnRnVsbCBwYXRoIG9mIGEgbm90ZScsXG4gICAgc2hvd1dhcm5pbmc6IHRydWUsXG59O1xuXG5pbnRlcmZhY2UgTElSUExpc3RJbnRlcmZhY2Uge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBpdGVtczogc3RyaW5nW107XG4gICAgZ2V0TGlzdFN1Z2dlc3Rpb24oKTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2U7XG4gICAgbm90SGlkZGVuKCk6IGJvb2xlYW47XG4gICAgcGlja1JhbmRvbUl0ZW0oKTogc3RyaW5nO1xuICAgIGdldFdhcm5pbmcoKTogc3RyaW5nW107XG59XG5cbmNsYXNzIExJUlBMaXN0IGltcGxlbWVudHMgTElSUExpc3RJbnRlcmZhY2Uge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBoaWRkZW46IGJvb2xlYW47XG4gICAgaXRlbXM6IHN0cmluZ1tdO1xuICAgIHdhcm5pbmc6IHN0cmluZ1tdXG5cbiAgICBjb25zdHJ1Y3RvcihsaW5lczogc3RyaW5nW10pIHtcbiAgICAgICAgdGhpcy50aXRsZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBcIlwiO1xuICAgICAgICB0aGlzLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLml0ZW1zID0gW107XG4gICAgICAgIHRoaXMud2FybmluZyA9IFtdO1xuXG4gICAgICAgIGNvbnN0IGhlYWRpbmdSZWdFeCA9IC9eIyArKC4rKSQvO1xuICAgICAgICB0aGlzLnRpdGxlID0gbGluZXNbMF0ucmVwbGFjZShoZWFkaW5nUmVnRXgsIFwiJDFcIik7XG4gICAgICAgIGNvbnN0IGl0YWxpY0hlYWRpbmdSZWdleCA9IC9eKF98XFwqKVxcUy87XG4gICAgICAgIGlmIChpdGFsaWNIZWFkaW5nUmVnZXgudGVzdCh0aGlzLnRpdGxlKSkge1xuICAgICAgICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsaW5lcy5zaGlmdCgpO1xuICAgICAgICBjb25zdCBsaXN0QmVnaW5JdGVtUmVnZXggPSAvXigtfFxcZCtcXC4pICsoLispJC87XG4gICAgICAgIGNvbnN0IGxpc3RCZWdpbkluZGV4ZXMgPSBmaW5kSW5kZXhlcyhsaW5lcywgKGVsZW1lbnQpID0+IGxpc3RCZWdpbkl0ZW1SZWdleC50ZXN0KGVsZW1lbnQpKTtcbiAgICAgICAgaWYgKGxpc3RCZWdpbkluZGV4ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLndhcm5pbmcucHVzaChgTm8gaXRlbXMgaW4gbGlzdCAke3RoaXMudGl0bGV9YCk7XG4gICAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2xlYW5MaW5lcyA9IGxpbmVzLm1hcCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQucmVwbGFjZShsaXN0QmVnaW5JdGVtUmVnZXgsIFwiJDJcIilcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChsaXN0QmVnaW5JbmRleGVzWzBdICE9PSAwKSB7XG4gICAgICAgICAgICBsZXQgbWREZXNjcmlwdGlvbiA9IGNsZWFuTGluZXMuc2xpY2UoMCwgbGlzdEJlZ2luSW5kZXhlc1swXSk7XG4gICAgICAgICAgICAvLyB0YWtpbmcgY2FyZSBvZiBNRDAyMlxuICAgICAgICAgICAgLy8gICBNRDAyMi9ibGFua3MtYXJvdW5kLWhlYWRpbmdzOiBIZWFkaW5ncyBzaG91bGQgYmUgc3Vycm91bmRlZCBieSBibGFuayBsaW5lc1xuICAgICAgICAgICAgaWYgKG1kRGVzY3JpcHRpb25bMF0gPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBtZERlc2NyaXB0aW9uLnNoaWZ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0YWtpbmcgY2FyZSBvZiBNRDAzMlxuICAgICAgICAgICAgLy8gICBNRDAzMi9ibGFua3MtYXJvdW5kLWxpc3RzOiBMaXN0cyBzaG91bGQgYmUgc3Vycm91bmRlZCBieSBibGFuayBsaW5lc1xuICAgICAgICAgICAgLy8gRHVlIHRvIHNwbGl0IG9uICdcXG4nLCB0aGUgc2xpY2UsIGFuZCBhdCBsZWFzdCBhIGpvaW4gb24gJ1xcbicgdGhlIGxhc3QgJ1xcbicgaXMgYWx3YXlzIGxvc3QgIVxuICAgICAgICAgICAgLy8gU28gdGhlIGZvbG93aW5nIGNvZGUgaXMgdXNlbGVzc1xuICAgICAgICAgICAgLy8gaWYgKG1kRGVzY3JpcHRpb24uYXQoLTEpID09PSBcIlwiKSB7XG4gICAgICAgICAgICAvLyAgICAgbWREZXNjcmlwdGlvbi5wb3AoKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBtZERlc2NyaXB0aW9uLmpvaW4oJ1xcbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IFwiXCI7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsaXN0QmVnaW5Db3VudCA9IGxpc3RCZWdpbkluZGV4ZXMubGVuZ3RoXG4gICAgICAgIGxldCBpdGVtOiBzdHJpbmdbXTtcbiAgICAgICAgZm9yIChsZXQgY3VycmVudEluZGV4ID0gMDsgY3VycmVudEluZGV4IDwgKGxpc3RCZWdpbkNvdW50IC0gMSk7IGN1cnJlbnRJbmRleCsrKSB7XG4gICAgICAgICAgICBpdGVtID0gKGNsZWFuTGluZXMuc2xpY2UobGlzdEJlZ2luSW5kZXhlc1tjdXJyZW50SW5kZXhdLCBsaXN0QmVnaW5JbmRleGVzW2N1cnJlbnRJbmRleCArIDFdKSk7XG4gICAgICAgICAgICB0aGlzLnB1c2hJdGVtQmFzZWRPbldlaWdodChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtID0gKGNsZWFuTGluZXMuc2xpY2UobGlzdEJlZ2luSW5kZXhlc1tsaXN0QmVnaW5Db3VudCAtIDFdKSk7XG4gICAgICAgIC8vIHRha2luZyBjYXJlIG9mIE1EMDIyXG4gICAgICAgIC8vICAgTUQwMjIvYmxhbmtzLWFyb3VuZC1oZWFkaW5nczogSGVhZGluZ3Mgc2hvdWxkIGJlIHN1cnJvdW5kZWQgYnkgYmxhbmsgbGluZXNcbiAgICAgICAgaWYgKGl0ZW0uYXQoLTEpID09PSBcIlwiKSB7XG4gICAgICAgICAgICBpdGVtLnBvcCgpO1xuICAgICAgICB9ICAgICAgICBcbiAgICAgICAgdGhpcy5wdXNoSXRlbUJhc2VkT25XZWlnaHQoaXRlbSk7XG4gICAgfVxuXG4gICAgcHVzaEl0ZW1CYXNlZE9uV2VpZ2h0KGl0ZW06IHN0cmluZ1tdKSA6IHZvaWQge1xuICAgICAgICBjb25zdCBJdGVtV2l0aFdlaWdodFJlZ0V4ID0gL15cXCgoXFxkKylcXClcXHMrKC4rKSQvO1xuICAgICAgICBsZXQgcmVnRXhFeGVjdXRpb25cbiAgICAgICAgbGV0IHJlcGVhdDogbnVtYmVyO1xuICAgICAgICBpZiAoKHJlZ0V4RXhlY3V0aW9uID0gSXRlbVdpdGhXZWlnaHRSZWdFeC5leGVjKGl0ZW1bMF0pKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVwZWF0ID0gTnVtYmVyKHJlZ0V4RXhlY3V0aW9uWzFdKTtcbiAgICAgICAgICAgIGl0ZW1bMF0gPSByZWdFeEV4ZWN1dGlvblsyXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcGVhdCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RyaW5nSXRlbSA9IGl0ZW0uam9pbignXFxuJyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVwZWF0OyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaChzdHJpbmdJdGVtKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBnZXRMaXN0U3VnZ2VzdGlvbigpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZSB7XG4gICAgICAgIGNvbnN0IHN1Z2dlc3Rpb24gPSB7XG4gICAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAodGhpcy5kZXNjcmlwdGlvbi5zcGxpdCgnXFxuJylbMF0pLFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdWdnZXN0aW9uO1xuICAgIH07XG5cbiAgICBub3RIaWRkZW4oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5oaWRkZW47XG4gICAgfVxuXG4gICAgcGlja1JhbmRvbUl0ZW0oKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHJhbmRvbUl0ZW06IHN0cmluZyA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJhbmRvbUl0ZW0gPSB0aGlzLml0ZW1zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuaXRlbXMubGVuZ3RoKV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmRvbUl0ZW07XG4gICAgfVxuXG4gICAgZ2V0V2FybmluZygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLndhcm5pbmc7XG4gICAgfVxuXG59XG5pbnRlcmZhY2UgTElSUE5vdGVJbnRlcmZhY2Uge1xuICAgIG5vdGVOYW1lOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBsb2FkRnJvbU5vdGUobm90ZU5hbWU6IHN0cmluZywgbm90ZUNvbnRlbnQ6IHN0cmluZyk6IGJvb2xlYW47XG4gICAgZ2V0Tm90ZVN1Z2dlc3Rpb24oKTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXTtcbiAgICBwaWNrUmFuZG9tSXRlbUZyb21MaXN0KGxpc3RUaXRsZTogc3RyaW5nLCBtYWNyb1JlY3Vyc2lvbjogbnVtYmVyKTogc3RyaW5nOyBcbiAgICBnZXRFcnJvcigpOiBzdHJpbmdbXTtcbiAgICBnZXRXYXJuaW5nKCk6IHN0cmluZ1tdO1xufVxuXG5jbGFzcyBMSVJQTm90ZSBpbXBsZW1lbnRzIExJUlBOb3RlSW50ZXJmYWNlIHtcbiAgICBub3RlTmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgbGlzdDogTElSUExpc3RbXTtcbiAgICBlcnJvcjogc3RyaW5nW107XG4gICAgd2FybmluZzogc3RyaW5nW107XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICAgIHRoaXMubm90ZU5hbWUgPSBcIlwiO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgICAgIHRoaXMuZXJyb3IgPSBbXTtcbiAgICAgICAgdGhpcy53YXJuaW5nID0gW107XG4gICAgfVxuXG4gICAgbG9hZEZyb21Ob3RlKG5vdGVOYW1lOiBzdHJpbmcsIG5vdGVDb250ZW50OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgdGhpcy5ub3RlTmFtZSA9IG5vdGVOYW1lO1xuICAgICAgICBjb25zdCBsaW5lcyA9IG5vdGVDb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgY29uc3QgaGVhZGluZ1JlZ2V4ID0gL14jIC4rJC87XG4gICAgICAgIGxldCBoZWFkaW5nSW5kZXhlcyA9IGZpbmRJbmRleGVzKGxpbmVzLCAoZWxlbWVudCkgPT4gaGVhZGluZ1JlZ2V4LnRlc3QoZWxlbWVudCkpO1xuICAgICAgICBpZiAoaGVhZGluZ0luZGV4ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yLnB1c2goYE5vIGhlYWRpbmcgaW4gbm90ZWApO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoZWFkaW5nSW5kZXhlc1swXSAhPT0gMCkge1xuICAgICAgICAgICAgLy8gdGFraW5nIGNhcmUgb2YgTUQwMjJcbiAgICAgICAgICAgIC8vICAgTUQwMjIvYmxhbmtzLWFyb3VuZC1oZWFkaW5nczogSGVhZGluZ3Mgc2hvdWxkIGJlIHN1cnJvdW5kZWQgYnkgYmxhbmsgbGluZXNcbiAgICAgICAgICAgIC8vIER1ZSB0byBzcGxpdCBvbiAnXFxuJywgdGhlIHNsaWNlLCBhbmQgYXQgbGVhc3QgYSBqb2luIG9uICdcXG4nIHRoZSBsYXN0ICdcXG4nIGlzIGFsd2F5cyBsb3N0ICFcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBsaW5lcy5zbGljZSgwLCBoZWFkaW5nSW5kZXhlc1swXSkuam9pbignXFxuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaGVhZGluZ0luZGV4ZXMgPSBmaW5kSW5kZXhlcyhsaW5lcywgKGVsZW1lbnQpID0+IGhlYWRpbmdSZWdleC50ZXN0KGVsZW1lbnQpKTtcbiAgICAgICAgY29uc3QgaGVhZGluZ0NvdW50ID0gaGVhZGluZ0luZGV4ZXMubGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGN1cnJlbnRJbmRleCA9IGhlYWRpbmdJbmRleGVzWzBdOyBjdXJyZW50SW5kZXggPCAoaGVhZGluZ0NvdW50IC0gMSk7IGN1cnJlbnRJbmRleCsrKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3QucHVzaChuZXcgTElSUExpc3QobGluZXMuc2xpY2UoaGVhZGluZ0luZGV4ZXNbY3VycmVudEluZGV4XSwgaGVhZGluZ0luZGV4ZXNbY3VycmVudEluZGV4ICsgMV0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5saXN0LnB1c2gobmV3IExJUlBMaXN0KGxpbmVzLnNsaWNlKGhlYWRpbmdJbmRleGVzW2hlYWRpbmdDb3VudCAtIDFdKSkpO1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIGdldE5vdGVTdWdnZXN0aW9uKCk6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW10ge1xuICAgICAgICBsZXQgbm90ZVN1Z2dlc3Rpb246IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW107XG4gICAgICAgIG5vdGVTdWdnZXN0aW9uID0gW107XG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5ub3RIaWRkZW4oKSkge1xuICAgICAgICAgICAgICAgIG5vdGVTdWdnZXN0aW9uLnB1c2goZWxlbWVudC5nZXRMaXN0U3VnZ2VzdGlvbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBub3RlU3VnZ2VzdGlvbjtcbiAgICB9XG5cbiAgICBleGVjTWFjcm9TdWJzdGl0dXRpb24oaXRlbTogc3RyaW5nLCBtYWNyb1JlY3Vyc2lvbjogbnVtYmVyID0gMSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNYWNyb1JlY3VzaW9uID0gbWFjcm9SZWN1cnNpb24gLTE7XG4gICAgICAgIGxldCBtb2RpZmllZEl0ZW06IHN0cmluZyA9IGl0ZW07XG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdHJpbmdUaXRsZVJlZ2V4ICA9IGBcXHsoJHtlbGVtZW50LnRpdGxlfSlcXH1gO1xuICAgICAgICAgICAgY29uc3QgdGl0bGVSZWdleCA9IG5ldyBSZWdFeHAoc3RyaW5nVGl0bGVSZWdleCwgJ20nKTtcbiAgICAgICAgICAgIHdoaWxlICh0aXRsZVJlZ2V4LnRlc3QobW9kaWZpZWRJdGVtKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4ZWNUaXRsZVJlZ2V4ID0gdGl0bGVSZWdleC5leGVjKG1vZGlmaWVkSXRlbSk7XG4gICAgICAgICAgICAgICAgaWYgKGV4ZWNUaXRsZVJlZ2V4ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RUaXRsZSA9IGV4ZWNUaXRsZVJlZ2V4WzFdXG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkSXRlbSA9IG1vZGlmaWVkSXRlbS5yZXBsYWNlKHRpdGxlUmVnZXgsIHRoaXMucGlja1JhbmRvbUl0ZW1Gcm9tTGlzdChsaXN0VGl0bGUsIGN1cnJlbnRNYWNyb1JlY3VzaW9uKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG1vZGlmaWVkSXRlbTtcbiAgICB9XG5cblxuICAgIHBpY2tSYW5kb21JdGVtRnJvbUxpc3QobGlzdFRpdGxlOiBzdHJpbmcsIG1hY3JvUmVjdXJzaW9uOiBudW1iZXIgPSAxKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHJhbmRvbUl0ZW06IHN0cmluZyA9IFwiXCI7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ID0gdGhpcy5saXN0LmZpbmQoKGVsZW1lbnQpID0+IGVsZW1lbnQudGl0bGUgPT09IGxpc3RUaXRsZSk7XG4gICAgICAgIGlmIChjdXJyZW50TGlzdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByYW5kb21JdGVtID0gY3VycmVudExpc3QucGlja1JhbmRvbUl0ZW0oKTtcbiAgICAgICAgICAgIGZvciAobGV0IHJlcGVhdCA9IDA7IHJlcGVhdCA8IG1hY3JvUmVjdXJzaW9uOyByZXBlYXQrKykge1xuICAgICAgICAgICAgICAgIHJhbmRvbUl0ZW0gPSB0aGlzLmV4ZWNNYWNyb1N1YnN0aXR1dGlvbihyYW5kb21JdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZG9tSXRlbTtcbiAgICB9IFxuXG4gICAgZ2V0RXJyb3IoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvcjtcbiAgICB9O1xuXG4gICAgZ2V0V2FybmluZygpOiBzdHJpbmdbXSB7XG4gICAgICAgIGxldCBhbGxXYXJuaW5nOiBzdHJpbmdbXTtcbiAgICAgICAgYWxsV2FybmluZyA9IFtdO1xuICAgICAgICBhbGxXYXJuaW5nID0gYWxsV2FybmluZy5jb25jYXQodGhpcy53YXJuaW5nKTtcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGFsbFdhcm5pbmcgPSBhbGxXYXJuaW5nLmNvbmNhdChlbGVtZW50LmdldFdhcm5pbmcoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgTm90ZVdhcm5pbmc6IHN0cmluZ1tdO1xuICAgICAgICBOb3RlV2FybmluZyA9IFtdO1xuICAgICAgICBhbGxXYXJuaW5nLmZvckVhY2goKGVsZW1lbnQpID0+IFxuICAgICAgICAgICAgTm90ZVdhcm5pbmcucHVzaChgV2FybmluZyBpbiBub3RlIFwiJHt0aGlzLm5vdGVOYW1lfVwiIDogJHtlbGVtZW50fWApXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBOb3RlV2FybmluZztcbiAgICB9O1xuXG59XG5pbnRlcmZhY2UgTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2Uge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbn1cblxuXG5leHBvcnQgY2xhc3MgTElSUFN1Z2dlc3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxMSVJQU3VnZ2VzdGlvbkludGVyZmFjZT4ge1xuICAgIGl0ZW1zOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdO1xuICAgIGNhbGxiYWNrOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZDtcbiAgXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGl0ZW1zOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdLCBjYWxsYmFjazogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgICAgIHN1cGVyKGFwcCk7XG4gICAgICB0aGlzLml0ZW1zID0gaXRlbXM7XG4gICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgZ2V0U3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5pdGVtcy5maWx0ZXIoKGl0ZW0pID0+XG4gICAgICAgICAgICBpdGVtLnRpdGxlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICBcbiAgICByZW5kZXJTdWdnZXN0aW9uKGl0ZW06IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlLCBlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgZWwuY3JlYXRlRWwoJ2RpdicsIHsgdGV4dDogaXRlbS50aXRsZSB9KTtcbiAgICAgICAgZWwuY3JlYXRlRWwoJ3NtYWxsJywge3RleHQ6IGl0ZW0uZGVzY3JpcHRpb259KTtcbiAgICAgIH1cbiAgXG4gICAgICBvbkNob29zZVN1Z2dlc3Rpb24oaXRlbTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2UsIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayhpdGVtLnRpdGxlKTtcbiAgICAgIH19XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExpc3RJdGVtUmFuZG9tUGlja2VyIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBzZXR0aW5nczogTElSUFBsdWdpblNldHRpbmdzO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgICAgIHRoaXMuYWRkUmliYm9uSWNvbignbGlzdC10cmVlJywgJ1BpY2sgcmFuZG9tIGxpc3QgaXRlbScsIChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZG9UaGVKb2IodGhpcy5zZXR0aW5ncy5ub3RlUGF0aCArICcubWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnaW5zZXJ0LXJhbmRvbS1pdGVtJyxcbiAgICAgICAgICAgIG5hbWU6ICdJbnNlcnQgcmFuZG9tIGl0ZW0gZnJvbSBsaXN0JyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb1RoZUpvYih0aGlzLnNldHRpbmdzLm5vdGVQYXRoICsgJy5tZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IExJUlBTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgfVxuXG4gICAgb251bmxvYWQoKSB7XG5cbiAgICB9XG5cbiAgICBhc3luYyBkb1RoZUpvYihmdWxsTm90ZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZ1bGxOb3RlUGF0aCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdOb3RlIG5vdCBmb3VuZCEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0ludmFsaWQgZmlsZSB0eXBlLiBFeHBlY3RlZCBhIE1hcmtkb3duIG5vdGUgZmlsZS4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKGZpbGUpO1xuICAgICAgICBjb25zdCBjdXJyZW50TElSUCA9IG5ldyBMSVJQTm90ZSgpO1xuXG4gICAgICAgIGNvbnN0IGxvYWRTdWNjZXNzID0gY3VycmVudExJUlAubG9hZEZyb21Ob3RlKHRoaXMuc2V0dGluZ3Mubm90ZVBhdGgsIGNvbnRlbnQpO1xuICAgICAgICBpZiAoIWxvYWRTdWNjZXNzKSB7XG4gICAgICAgICAgICBjdXJyZW50TElSUC5nZXRFcnJvcigpLmZvckVhY2goKGVsZW1lbnQpID0+IG5ldyBOb3RpY2UoZWxlbWVudCkpO1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3Muc2hvd1dhcm5pbmcpIHtcbiAgICAgICAgICAgIGN1cnJlbnRMSVJQLmdldFdhcm5pbmcoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgbmV3IExJUlBTdWdnZXN0TW9kYWwodGhpcy5hcHAsIGN1cnJlbnRMSVJQLmdldE5vdGVTdWdnZXN0aW9uKCksICh0aXRsZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRTdHJpbmcoY3VycmVudExJUlAucGlja1JhbmRvbUl0ZW1Gcm9tTGlzdCh0aXRsZSkpO1xuICAgICAgICB9KS5vcGVuKCk7XG4gICAgfVxuXG4gICAgaW5zZXJ0U3RyaW5nKGN1cnJlbnRTdHJpbmc6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcblxuICAgICAgICBpZiAoYWN0aXZlVmlldykge1xuICAgICAgICAgICAgY29uc3QgZWRpdG9yID0gYWN0aXZlVmlldy5lZGl0b3I7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbihjdXJyZW50U3RyaW5nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJObyBhY3RpdmUgTWFya2Rvd24gZWRpdG9yIGZvdW5kLlwiKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cbn1cblxuY2xhc3MgTElSUFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBwbHVnaW46IExpc3RJdGVtUmFuZG9tUGlja2VyO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTGlzdEl0ZW1SYW5kb21QaWNrZXIpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ05vdGUgUGF0aCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnUGF0aCB0byB0aGUgbm90ZSBjb250YWluaW5nIHRoZSBsaXN0cy4nKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFbnRlciB0aGUgcGF0aCB0byB5b3VyIG5vdGUnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ub3RlUGF0aClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm5vdGVQYXRoID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAuc2V0TmFtZShcIlNob3cgd2FybmluZ1wiKVxuICAgICAgICAuc2V0RGVzYyhcIlNob3cgd2FybmluZ3Mgb2YgTm90ZSBhbmQgbGlzdHMsIGlmIHByZXNlbnQuXCIpXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT4ge1xuICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNob3dXYXJuaW5nKTtcbiAgICAgICAgICAgIHRvZ2dsZS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93V2FybmluZyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfVxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLHNCQUF5RztBQUV6RyxTQUFTLFlBQWUsU0FBYyxXQUE2RDtBQUMvRixRQUFNLFVBQW9CLENBQUM7QUFDM0IsVUFBUSxRQUFRLENBQUMsU0FBUyxVQUFVO0FBQ2xDLFFBQUksVUFBVSxTQUFTLEtBQUssR0FBRztBQUM3QixjQUFRLEtBQUssS0FBSztBQUFBLElBQ3BCO0FBQUEsRUFDRixDQUFDO0FBQ0QsU0FBTztBQUNUO0FBTUYsSUFBTSxtQkFBdUM7QUFBQSxFQUN6QyxVQUFVO0FBQUEsRUFDVixhQUFhO0FBQ2pCO0FBWUEsSUFBTSxXQUFOLE1BQTRDO0FBQUEsRUFPeEMsWUFBWSxPQUFpQjtBQUN6QixTQUFLLFFBQVE7QUFDYixTQUFLLGNBQWM7QUFDbkIsU0FBSyxTQUFTO0FBQ2QsU0FBSyxRQUFRLENBQUM7QUFDZCxTQUFLLFVBQVUsQ0FBQztBQUVoQixVQUFNLGVBQWU7QUFDckIsU0FBSyxRQUFRLE1BQU0sQ0FBQyxFQUFFLFFBQVEsY0FBYyxJQUFJO0FBQ2hELFVBQU0scUJBQXFCO0FBQzNCLFFBQUksbUJBQW1CLEtBQUssS0FBSyxLQUFLLEdBQUc7QUFDckMsV0FBSyxTQUFTO0FBQUEsSUFDbEIsT0FBTztBQUNILFdBQUssU0FBUztBQUFBLElBQ2xCO0FBQ0EsVUFBTSxNQUFNO0FBQ1osVUFBTSxxQkFBcUI7QUFDM0IsVUFBTSxtQkFBbUIsWUFBWSxPQUFPLENBQUMsWUFBWSxtQkFBbUIsS0FBSyxPQUFPLENBQUM7QUFDekYsUUFBSSxpQkFBaUIsV0FBVyxHQUFHO0FBQy9CLFdBQUssUUFBUSxLQUFLLG9CQUFvQixLQUFLLE9BQU87QUFDbEQsV0FBSyxTQUFTO0FBQ2Q7QUFBQSxJQUNKO0FBQ0Es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
