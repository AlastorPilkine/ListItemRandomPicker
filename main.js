/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var P=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var W=(c,i)=>{for(var e in i)P(c,e,{get:i[e],enumerable:!0})},C=(c,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of D(i))!M.call(c,s)&&s!==e&&P(c,s,{get:()=>i[s],enumerable:!(t=$(i,s))||t.enumerable});return c};var A=c=>C(P({},"__esModule",{value:!0}),c);var H={};W(H,{LIRPSuggestModal:()=>S,default:()=>b});module.exports=A(H);var l=require("obsidian");function V(c,i){let e=[];return c.forEach((t,s)=>{i(t,s)&&e.push(s)}),e}function F(c){return c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var B={notePath:"Path of a note or a folder",showWarning:!0,maxMacroDepth:1,selectionForNotification:"!",deleteSelectionForNotification:!1,nullValue:"null",escapeValue:"//",showNoteSelector:!0},T=class{checkDice(i){return/^(\d+)?d(\d+)([\+\-]\d+)?(e)?(k\d+)?(kl\d+)?$/i.test(i)}rollDice(i){if(!this.checkDice(i))throw new Error("Syntaxe de lancer de d\xE9s invalide.");let[e,t,s,o,r,n,a]=i.match(/^(\d+)?d(\d+)([\+\-]\d+)?(e)?(k\d+)?(kl\d+)?$/i),u=parseInt(t||"1"),d=parseInt(s),g=parseInt(o||"0"),R=!!r,L=n?parseInt(n.slice(1)):void 0,w=a?parseInt(a.slice(2)):void 0,h=[];for(let f=0;f<u;f++){let p=Math.floor(Math.random()*d)+1;if(h.push(p),R)for(;p===d;)p=Math.floor(Math.random()*d)+1,h.push(p)}return L?(h.sort((f,p)=>p-f),h=h.slice(0,L)):w&&(h.sort((f,p)=>f-p),h=h.slice(0,w)),h.reduce((f,p)=>f+p,0)+g}replaceDiceRolls(i,e,t){let s=new RegExp(`${this.escapeRegExp(e)}([^${this.escapeRegExp(e+t)}]+)${this.escapeRegExp(t)}`,"g");return i.replace(s,(o,r)=>{try{return this.rollDice(r).toString()}catch(n){return o}})}escapeRegExp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},v=class{getType(){let i=["dupInNote","dupInFolder"];return"warning"}constructor(i,e,t,s=""){this.noteName=i,this.listTitle=e,this.status=t,this.complement=s}toString(){return`${this.getType()} / ${this.noteName} / ${this.listTitle} / ${this.status} / ${this.complement}`}},N=class{constructor(){this.logs=[]}push(i,e,t,s=""){this.logs.push(new v(i,e,t,s))}add(i){this.logs=this.logs.concat(i.logs)}get(i){let e=this.logs.filter(s=>s.getType()===i),t=[];return e.map(s=>{t.push(s.toString())}),t}},I=class{static getSettingString(i=""){if(i==="")return`- [ ] Hide this list
`;switch(i){case"hide":return"^- \\[[x ]\\] Hide this list$";case"hide_ticked":return"^- \\[x\\] Hide this list$"}}constructor(i,e,t,s){this.title="",this.description="",this.hidden=!1,this.items=[],this.logs=new N,this.nullValue=t,this.escapeString=s;let o=/^# +(.+)$/;this.title=e[0].replace(o,"$1"),e.shift();let r=/^(-|\d+\.) (?!\[) *(.+)$/,n=V(e,g=>r.test(g));if(n.length===0){this.logs.push(i,this.title,"emptyList"),this.hidden=!0;return}let a=e.map(g=>g.replace(r,"$2"));if(n[0]!==0){let g=a.slice(0,n[0]);g[0]===""&&g.shift();let R=!1,L=new RegExp(I.getSettingString("hide_ticked")),w=new RegExp(I.getSettingString("hide"));g.map(h=>{L.test(h)&&(R=!0,this.hidden=R)}),g=g.filter(h=>!w.test(h)),this.description=g.join(`
`)}else this.description="";let u=n.length,d;for(let g=0;g<u-1;g++)d=a.slice(n[g],n[g+1]),this.pushItemBasedOnWeight(d);d=a.slice(n[u-1]),d.at(-1)===""&&d.pop(),this.pushItemBasedOnWeight(d)}pushItemBasedOnWeight(i){let e=/^\((\d+)\)\s+(.+)$/,t,s;(t=e.exec(i[0]))!==null?(s=Number(t[1]),i[0]=t[2]):s=1,i[0]===this.nullValue&&(i.length===1?i[0]="":i.shift());let o=`^ *${this.escapeString}(.*)`,r=new RegExp(o,"gm"),a=i.map(u=>u.replace(r,"$1")).join(`
`);for(let u=0;u<s;u++)this.items.push(a)}getSuggestion(i){return{noteName:i,title:this.title,description:this.description.split(`
`)[0]}}notHidden(){return!this.hidden}pickRandomItem(){let i="";return this.items.length>0&&(i=this.items[Math.floor(Math.random()*this.items.length)]),i}getWarning(){return this.logs.get("warning")}},x=class{constructor(i,e,t){this.noteName="",this.description="",this.list=[],this.logs=new N,this.nullValue=i,this.escapeString=e,this.rollDice=!0,this.referenceMaxDepth=t}getListTitles(){let i=[];return this.list.map(e=>{i.push(e.title)}),i}loadFromNote(i,e){this.noteName=i;let t=e.split(`
`),s=/^# .+$/,o=V(t,n=>s.test(n));if(o.length===0)return this.logs.push(i,"","emptyNote"),!1;o[0]!==0&&(this.description=t.slice(0,o[0]).join(`
`));let r=o.length;for(let n=0;n<r-1;n++)this.pushListIfNotExists(new I(this.noteName,t.slice(o[n],o[n+1]),this.nullValue,this.escapeString));return this.pushListIfNotExists(new I(this.noteName,t.slice(o[r-1]),this.nullValue,this.escapeString)),!0}pushListIfNotExists(i){return this.getListTitles().contains(i.title)?(this.logs.push(this.noteName,i.title,"dupInNote"),!1):(this.list.push(i),!0)}getListSuggestion(i=!1){let e=new m;return this.list.forEach(t=>{(i||t.notHidden())&&e.push(t.getSuggestion(this.noteName))}),e}execReferenceSubstitution(i){let e=`{(${this.list.map(n=>F(n.title)).join("|")})}`,t=new RegExp(e,"mg"),s,o=i,r="";for(;(s=t.exec(o))!==null;){let n=this.pickRandomItemFromList(s[1],!1);r=s[0],o=o.replace(r,n),t.lastIndex=s.index+n.length}return{lastListTitle:r,modifiedItem:o}}pickRandomItemFromList(i,e=!0){let t="",s={lastListTitle:i,modifiedItem:""},o=this.list.find(a=>a.title===i);if(o!==void 0){t=o.pickRandomItem();for(let a=0;a<this.referenceMaxDepth;a++)s=this.execReferenceSubstitution(t),t=s.modifiedItem}let r=`{(${this.list.map(a=>F(a.title)).join("|")})}`;return new RegExp(r).test(t)&&e&&new l.Notice(`Macro depth limit reached in note "${this.noteName}" after calling "${s.lastListTitle}"`),e&&this.rollDice?new T().replaceDiceRolls(t,"{","}"):t}getError(){return this.logs.get("error")}getWarning(){let i=this.logs.get("warning");return this.list.forEach(e=>{i=i.concat(e.getWarning())}),i}get length(){return this.list.length}},y=class{constructor(i,e,t){this.multiNote=[],this.nullValue=i,this.escapeString=e,this.referenceMaxDepth=t,this.logs=new N}loadFromNote(i,e){let t=new x(this.nullValue,this.escapeString,this.referenceMaxDepth),s=t.loadFromNote(i,e);return this.pushNoteIfListNotExists(t),s}pushNoteIfListNotExists(i){let e=this.getListTitles(),t=!0;return i.getListTitles().map(s=>{e.contains(s)&&(this.logs.push(i.noteName,s,"dupInFolder",this.getNoteNameFromListTitle(s)),t=!1)}),t?this.multiNote.push(i):this.logs.add(i.logs),t}getNoteNameFromListTitle(i){let e=this.multiNote.find(t=>t.getListTitles().contains(i));return e!==void 0?e.noteName:""}getListTitles(){let i=[];return this.multiNote.map(e=>{i=i.concat(e.getListTitles())}),i}getListSuggestion(i=!1){let e=new m;return this.multiNote.map(t=>{e=e.concat(t.getListSuggestion())}),e}getNoteSuggestion(i=!1){let e=new m;return this.multiNote.map(t=>{t.getListSuggestion(i).length>0&&e.push({noteName:t.noteName,title:t.noteName,description:t.description.split(`
`)[0]})}),e}pickRandomItemFromList(i,e=!0){let t=new x(this.nullValue,this.escapeString,this.referenceMaxDepth);return this.multiNote.map(s=>{t.list=t.list.concat(s.list)}),t.pickRandomItemFromList(i)}getError(){let i=[];return this.multiNote.map(e=>{i=i.concat(e.getError())}),i}getWarning(){let i=this.logs.get("warning");return this.multiNote.map(e=>{i=i.concat(e.getWarning())}),i}get length(){return this.multiNote.length}},m=class{constructor(){this.list=[]}push(i){this.list.push(i)}filterByNoteName(i){let e=new m;return this.list.map(t=>{t.noteName===i&&e.push(t)}),e}filter(i){let e=new m;for(let t=0;t<this.list.length;t++)i(this.list[t],t,this.list)&&e.push(this.list[t]);return e}concat(i){let e=new m;return e.list=this.list.concat(i.list),e}get length(){return this.list.length}},S=class extends l.SuggestModal{constructor(e,t,s){super(e);this.items=t,this.callback=s}getSuggestions(e){return this.items.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())).list}renderSuggestion(e,t){t.createEl("div",{text:e.title});let s=e.description;t.createEl("small",{text:s})}onChooseSuggestion(e,t){this.callback(e)}},b=class extends l.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("list-tree","Pick random list item",e=>{this.doTheJob("note")}),this.addCommand({id:"insert-random-item",name:"Insert random item from list",callback:()=>{this.doTheJob("note")}}),this.addCommand({id:"insert-setting-item",name:"Insert list settings values",callback:()=>{this.insertString(I.getSettingString())}}),this.addCommand({id:"insert-reference-item",name:"Insert list reference",callback:()=>{this.doTheJob("reference")}}),this.addSettingTab(new k(this.app,this))}onunload(){}async doTheJob(e){let t=this.getLIRPFiles(this.settings.notePath),s=new y(this.settings.nullValue,this.settings.escapeValue,this.settings.maxMacroDepth),o=!0;for(let r of t){let n=this.app.vault.getAbstractFileByPath(r),a="";n instanceof l.TFile&&(a=await this.app.vault.cachedRead(n),o=s.loadFromNote(n.path.slice(0,-3),a)&&o)}if(!(!o&&(s.getError().map(r=>{new l.Notice(r)}),s.length===0)))if(this.settings.showWarning&&s.getWarning().forEach(r=>{new l.Notice(r)}),s.length===0){new l.Notice('Error : check settings "Path " in plugin List Item Random Picker !');return}else s.length===1?new S(this.app,s.getListSuggestion(),r=>{e==="note"?this.workWithTitle(s,r.title):this.insertString(`{${r.title}}`)}).open():this.settings.showNoteSelector?new S(this.app,s.getNoteSuggestion(),r=>{new S(this.app,s.getListSuggestion().filterByNoteName(r.noteName),n=>{e==="note"?this.workWithTitle(s,n.title):this.insertString(`{${n.title}}`)}).open()}).open():new S(this.app,s.getListSuggestion(),r=>{this.workWithTitle(s,r.title)}).open()}getLIRPFiles(e){let t=this.app.vault.getFiles(),s=[],o=new RegExp(`^${e}(/.+)?.md$`);return t.map(r=>{o.test(r.path)&&s.push(r.path)}),s}workWithTitle(e,t){let s=this.app.workspace.getActiveViewOfType(l.MarkdownView);if(s){let o=`^${this.settings.selectionForNotification}$`,r=new RegExp(o),n=s.editor,a=n.getSelection();if(r.test(a))new l.Notice(e.pickRandomItemFromList(t)),this.settings.deleteSelectionForNotification&&n.replaceSelection("");else{let u="",d=/^(\d+)(.*)/gm,g,R;if((g=d.exec(a))!==null){let L=Number(g[1]),w=a.replace(/^\d+/,""),h=[];for(let E=0;E<L;E++)h.push(e.pickRandomItemFromList(t));u=h.join(w)}else u=e.pickRandomItemFromList(t);n.replaceSelection(u)}}else new l.Notice("No active Markdown editor found.")}insertString(e){let t=this.app.workspace.getActiveViewOfType(l.MarkdownView);t?t.editor.replaceSelection(e):new l.Notice("No active Markdown editor found.")}async loadSettings(){this.settings=Object.assign({},B,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},k=class extends l.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Note setting"}),new l.Setting(e).setName("Note Path").setDesc('The path and filename of the note that contains the lists to be used. Exemple : "Folder/Note".').addText(t=>t.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async s=>{this.plugin.settings.notePath=s,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Interface settings"}),new l.Setting(e).setName("Show note selector").setDesc("If path is a folder").addToggle(t=>{t.setValue(this.plugin.settings.showNoteSelector),t.onChange(async s=>{this.plugin.settings.showNoteSelector=s,await this.plugin.saveSettings()})}),new l.Setting(e).setName("Show warning").setDesc("Display the warnings of notes and lists, if any. Warnings for macro depth limit reached are always displayed.").addToggle(t=>{t.setValue(this.plugin.settings.showWarning),t.onChange(async s=>{this.plugin.settings.showWarning=s,await this.plugin.saveSettings()})}),e.createEl("h2",{text:"List settings"}),new l.Setting(e).setName("Null value").setDesc("If the first line of an item has this value, the line is flush.").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.nullValue).onChange(async s=>{this.plugin.settings.nullValue=s,await this.plugin.saveSettings()})),new l.Setting(e).setName("Escape value").setDesc("If you want some headin one or first level list item in your item, you could escape them with these value").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.escapeValue).onChange(async s=>{this.plugin.settings.escapeValue=s,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Selection settings"}),new l.Setting(e).setName("Selection value for notification").setDesc("If the text selected has this value, the item is not inserted, but notified !").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.selectionForNotification).onChange(async s=>{this.plugin.settings.selectionForNotification=s,await this.plugin.saveSettings()})),new l.Setting(e).setName("Delete selection value for notification").setDesc("If set, the selected value for notification is deleted.").addToggle(t=>{t.setValue(this.plugin.settings.deleteSelectionForNotification),t.onChange(async s=>{this.plugin.settings.deleteSelectionForNotification=s,await this.plugin.saveSettings()})}),e.createEl("h2",{text:"Technical settings"}),new l.Setting(e).setName("Macro depth limit").setDesc("Macro recursion limit: how many nested macro calls are allowed. Zero prevents nested macros from being resolved.").addSlider(t=>t.setValue(this.plugin.settings.maxMacroDepth).setLimits(0,10,1).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxMacroDepth=s,await this.plugin.saveSettings()}))}};
