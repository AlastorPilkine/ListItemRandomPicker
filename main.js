/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  LIRPSuggestModal: () => LIRPSuggestModal,
  default: () => ListItemRandomPicker
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
function findIndexes(anArray, predicate) {
  const indexes = [];
  anArray.forEach((element, index) => {
    if (predicate(element, index)) {
      indexes.push(index);
    }
  });
  return indexes;
}
var DEFAULT_SETTINGS = {
  notePath: "Full path of a note"
};
var LIRPList = class {
  constructor(lines) {
    this.items = [];
    this.warning = [];
    const headingRegEx = /^# +(.+)$/;
    this.title = lines[0].replace(headingRegEx, "$1");
    lines.splice(0, 1);
    const listBeginItemRegex = /^(-|\d+\.) +(.+)$/;
    const listBeginIndexes = findIndexes(lines, (element) => listBeginItemRegex.test(element));
    if (listBeginIndexes.length === 0) {
      this.warning.push("No list items in note");
      return;
    }
    const cleanLines = lines.map((element) => {
      return element.replace(listBeginItemRegex, "$2");
    });
    if (listBeginIndexes[0] !== 0) {
      this.description = cleanLines.slice(0, 1).join("\n");
    } else {
      this.description = "";
    }
    const listBeginCount = listBeginIndexes.length;
    for (let currentIndex = 0; currentIndex < listBeginCount - 1; currentIndex++) {
      this.items.push(cleanLines.slice(listBeginIndexes[currentIndex], listBeginIndexes[currentIndex + 1]).join("\n"));
    }
    this.items.push(cleanLines.slice(listBeginIndexes[listBeginCount - 1]).join("\n"));
  }
  pickRandomItem() {
    if (this.items.length > 0) {
      return this.items[Math.floor(Math.random() * this.items.length)];
    } else {
      return "";
    }
  }
};
var LIRPNote = class {
  constructor() {
    this.fullPath = "";
    this.description = "";
    this.list = [];
    this.error = [];
    this.warning = [];
  }
  loadFromNote(noteContent) {
    const lines = noteContent.split("\n");
    const headingRegex = /^# .+$/;
    let headingIndexes = findIndexes(lines, (element) => headingRegex.test(element));
    if (headingIndexes.length === 0) {
      this.error.push("No heading in note");
      return false;
    }
    let headingBegin = 0;
    if (headingIndexes[0] !== 0) {
      this.description = lines.slice(0, headingIndexes[0] - 1).join("\n");
      headingBegin = headingIndexes[0];
    }
    const headingCount = headingIndexes.length;
    for (let currentIndex = headingBegin; currentIndex < headingCount - 1; currentIndex++) {
      this.list.push(new LIRPList(lines.slice(headingIndexes[currentIndex], headingIndexes[currentIndex + 1])));
    }
    this.list.push(new LIRPList(lines.slice(headingIndexes[headingCount - 1])));
    return true;
  }
  getListSuggestion() {
    let listSuggestion;
    listSuggestion = [];
    this.list.forEach((element) => {
      listSuggestion.push({
        title: element.title,
        description: element.description
      });
    });
    return listSuggestion;
  }
  pickRandomItemFromList(listTitle) {
    const currentList = this.list.find((element) => element.title === listTitle);
    if (currentList !== void 0) {
      return currentList.pickRandomItem();
    } else {
      return "";
    }
  }
  getError() {
    return [];
  }
  getWarning() {
    return [];
  }
};
var LIRPSuggestModal = class extends import_obsidian.SuggestModal {
  constructor(app, items, callback) {
    super(app);
    this.items = items;
    this.callback = callback;
  }
  getSuggestions(query) {
    return this.items.filter(
      (item) => item.title.toLowerCase().includes(query.toLowerCase())
    );
  }
  renderSuggestion(item, el) {
    el.createEl("div", { text: item.title });
    el.createEl("small", { text: item.description });
  }
  onChooseSuggestion(item, evt) {
    this.callback(item.title);
  }
};
var ListItemRandomPicker = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("list-tree", "Pick random list item", (evt) => {
      this.doTheJob(this.settings.notePath + ".md");
    });
    this.addCommand({
      id: "insert-random-item",
      name: "Insert random item from list",
      callback: () => {
        this.doTheJob(this.settings.notePath + ".md");
      }
    });
    this.addSettingTab(new LIRPSettingTab(this.app, this));
  }
  onunload() {
  }
  async doTheJob(fullNotePath) {
    const file = this.app.vault.getAbstractFileByPath(fullNotePath);
    if (!file) {
      new import_obsidian.Notice("Note not found!");
      return;
    }
    if (!(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice("Invalid file type. Expected a Markdown note file.");
      return;
    }
    const content = await this.app.vault.cachedRead(file);
    const currentLIRP = new LIRPNote();
    const loadSuccess = currentLIRP.loadFromNote(content);
    if (!loadSuccess) {
      currentLIRP.error.forEach((element) => new import_obsidian.Notice(element));
      return;
    }
    new LIRPSuggestModal(this.app, currentLIRP.getListSuggestion(), (title) => {
      this.insertString(currentLIRP.pickRandomItemFromList(title));
    }).open();
  }
  insertString(currentString) {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (activeView) {
      const editor = activeView.editor;
      const selection = editor.getSelection();
      editor.replaceSelection(currentString);
    } else {
      new import_obsidian.Notice("No active Markdown editor found.");
    }
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var LIRPSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Note Path").setDesc("Path to the note containing the lists.").addText((text) => text.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async (value) => {
      this.plugin.settings.notePath = value;
      await this.plugin.saveSettings();
    }));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgU3VnZ2VzdE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcblxuZnVuY3Rpb24gZmluZEluZGV4ZXM8VD4oYW5BcnJheTogVFtdLCBwcmVkaWNhdGU6IChlbGVtZW50OiBULCBpbmRleDogbnVtYmVyKSA9PiBib29sZWFuKTogbnVtYmVyW10ge1xuICAgIGNvbnN0IGluZGV4ZXM6IG51bWJlcltdID0gW107XG4gICAgYW5BcnJheS5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHByZWRpY2F0ZShlbGVtZW50LCBpbmRleCkpIHtcbiAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaW5kZXhlcztcbiAgfVxuaW50ZXJmYWNlIExJUlBQbHVnaW5TZXR0aW5ncyB7XG4gICAgbm90ZVBhdGg6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTElSUFBsdWdpblNldHRpbmdzID0ge1xuICAgIG5vdGVQYXRoOiAnRnVsbCBwYXRoIG9mIGEgbm90ZSdcbn07XG5cbmludGVyZmFjZSBMSVJQTGlzdEludGVyZmFjZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGhpZGRlbjogYm9vbGVhbjtcbiAgICBtYWNybzogYm9vbGVhbjtcbiAgICBpdGVtczogc3RyaW5nW107XG4gICAgd2FybmluZzogc3RyaW5nW107XG4gICAgcGlja1JhbmRvbUl0ZW0oKTogc3RyaW5nO1xufVxuXG5jbGFzcyBMSVJQTGlzdCBpbXBsZW1lbnRzIExJUlBMaXN0SW50ZXJmYWNlIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgaGlkZGVuOiBib29sZWFuO1xuICAgIG1hY3JvOiBib29sZWFuO1xuICAgIGl0ZW1zOiBzdHJpbmdbXTtcbiAgICB3YXJuaW5nOiBzdHJpbmdbXVxuXG4gICAgY29uc3RydWN0b3IobGluZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy53YXJuaW5nID0gW107XG4gICAgICAgIFxuICAgICAgICBjb25zdCBoZWFkaW5nUmVnRXggPSAvXiMgKyguKykkLztcbiAgICAgICAgLy8gdG8gZG8gaGlkZGVuIGxpc3RcbiAgICAgICAgdGhpcy50aXRsZSA9IGxpbmVzWzBdLnJlcGxhY2UoaGVhZGluZ1JlZ0V4LCBcIiQxXCIpO1xuICAgICAgICBsaW5lcy5zcGxpY2UoMCwgMSk7XG4gICAgICAgIGNvbnN0IGxpc3RCZWdpbkl0ZW1SZWdleCA9IC9eKC18XFxkK1xcLikgKyguKykkLztcbiAgICAgICAgY29uc3QgbGlzdEJlZ2luSW5kZXhlcyA9IGZpbmRJbmRleGVzKGxpbmVzLCAoZWxlbWVudCkgPT4gbGlzdEJlZ2luSXRlbVJlZ2V4LnRlc3QoZWxlbWVudCkpO1xuICAgICAgICBpZiAobGlzdEJlZ2luSW5kZXhlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMud2FybmluZy5wdXNoKCdObyBsaXN0IGl0ZW1zIGluIG5vdGUnKTtcbiAgICAgICAgICAgIC8vIHRvIGRvIDogTWFjcm8gIVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNsZWFuTGluZXMgPSBsaW5lcy5tYXAoKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnJlcGxhY2UobGlzdEJlZ2luSXRlbVJlZ2V4LCBcIiQyXCIpXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobGlzdEJlZ2luSW5kZXhlc1swXSAhPT0gMCkge1xuICAgICAgICAgICAgLy8gdGhlcmUgaXMgYSBkZXNjcmlwdGlvblxuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGNsZWFuTGluZXMuc2xpY2UoMCwgMSkuam9pbignXFxuJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxpc3RCZWdpbkNvdW50ID0gbGlzdEJlZ2luSW5kZXhlcy5sZW5ndGhcbiAgICAgICAgZm9yIChsZXQgY3VycmVudEluZGV4ID0gMDsgY3VycmVudEluZGV4IDwgKGxpc3RCZWdpbkNvdW50IC0gMSk7IGN1cnJlbnRJbmRleCsrKSB7XG4gICAgICAgICAgICAvLyB0byBkbyBpdGVtIHdlaWdodFxuICAgICAgICAgICAgdGhpcy5pdGVtcy5wdXNoKChjbGVhbkxpbmVzLnNsaWNlKGxpc3RCZWdpbkluZGV4ZXNbY3VycmVudEluZGV4XSwgbGlzdEJlZ2luSW5kZXhlc1tjdXJyZW50SW5kZXggKyAxXSkuam9pbignXFxuJykpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLml0ZW1zLnB1c2goKGNsZWFuTGluZXMuc2xpY2UobGlzdEJlZ2luSW5kZXhlc1tsaXN0QmVnaW5Db3VudCAtIDFdKS5qb2luKCdcXG4nKSkpO1xuICAgIH1cblxuICAgIHBpY2tSYW5kb21JdGVtKCk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZW1zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuaXRlbXMubGVuZ3RoKV07IC8vLnJlcGxhY2UoL1xcbi9nLCAnJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuXG59XG5pbnRlcmZhY2UgTElSUE5vdGVJbnRlcmZhY2Uge1xuICAgIGZ1bGxQYXRoOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBsb2FkRnJvbU5vdGUobm90ZUNvbnRlbnQ6IHN0cmluZyk6IGJvb2xlYW47XG4gICAgZ2V0TGlzdFN1Z2dlc3Rpb24oKTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXTtcbiAgICBwaWNrUmFuZG9tSXRlbUZyb21MaXN0KGxpc3RUaXRsZTogc3RyaW5nKTogc3RyaW5nOyBcbiAgICBnZXRFcnJvcigpOiBzdHJpbmdbXTtcbiAgICBnZXRXYXJuaW5nKCk6IHN0cmluZ1tdO1xufVxuXG5jbGFzcyBMSVJQTm90ZSBpbXBsZW1lbnRzIExJUlBOb3RlSW50ZXJmYWNlIHtcbiAgICBmdWxsUGF0aDogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgbGlzdDogTElSUExpc3RbXTtcbiAgICBlcnJvcjogc3RyaW5nW107XG4gICAgd2FybmluZzogc3RyaW5nW107XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICAgIHRoaXMuZnVsbFBhdGggPSBcIlwiO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgICAgIHRoaXMuZXJyb3IgPSBbXTtcbiAgICAgICAgdGhpcy53YXJuaW5nID0gW107XG4gICAgfVxuXG4gICAgbG9hZEZyb21Ob3RlKG5vdGVDb250ZW50OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgbGluZXMgPSBub3RlQ29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICAgIGNvbnN0IGhlYWRpbmdSZWdleCA9IC9eIyAuKyQvO1xuICAgICAgICBsZXQgaGVhZGluZ0luZGV4ZXMgPSBmaW5kSW5kZXhlcyhsaW5lcywgKGVsZW1lbnQpID0+IGhlYWRpbmdSZWdleC50ZXN0KGVsZW1lbnQpKTtcbiAgICAgICAgaWYgKGhlYWRpbmdJbmRleGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5lcnJvci5wdXNoKCdObyBoZWFkaW5nIGluIG5vdGUnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaGVhZGluZ0JlZ2luID0gMDtcbiAgICAgICAgaWYgKGhlYWRpbmdJbmRleGVzWzBdICE9PSAwKSB7XG4gICAgICAgICAgICAvLyB0aGVyZSBpcyBhIGRlc2NyaXB0aW9uXG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gbGluZXMuc2xpY2UoMCwgaGVhZGluZ0luZGV4ZXNbMF0gLTEpLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgaGVhZGluZ0JlZ2luID0gaGVhZGluZ0luZGV4ZXNbMF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVhZGluZ0NvdW50ID0gaGVhZGluZ0luZGV4ZXMubGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGN1cnJlbnRJbmRleCA9IGhlYWRpbmdCZWdpbjsgY3VycmVudEluZGV4IDwgKGhlYWRpbmdDb3VudCAtIDEpOyBjdXJyZW50SW5kZXgrKykge1xuICAgICAgICAgICAgdGhpcy5saXN0LnB1c2gobmV3IExJUlBMaXN0KGxpbmVzLnNsaWNlKGhlYWRpbmdJbmRleGVzW2N1cnJlbnRJbmRleF0sIGhlYWRpbmdJbmRleGVzW2N1cnJlbnRJbmRleCArIDFdKSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGlzdC5wdXNoKG5ldyBMSVJQTGlzdChsaW5lcy5zbGljZShoZWFkaW5nSW5kZXhlc1toZWFkaW5nQ291bnQgLSAxXSkpKTtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBnZXRMaXN0U3VnZ2VzdGlvbigpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdIHtcbiAgICAgICAgbGV0IGxpc3RTdWdnZXN0aW9uOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdO1xuICAgICAgICBsaXN0U3VnZ2VzdGlvbiA9IFtdO1xuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgLy8gdG8gZG8gaGlkZGVuIGxpc3RcbiAgICAgICAgICAgIGxpc3RTdWdnZXN0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBlbGVtZW50LnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBlbGVtZW50LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBsaXN0U3VnZ2VzdGlvbjtcbiAgICB9XG5cbiAgICBwaWNrUmFuZG9tSXRlbUZyb21MaXN0KGxpc3RUaXRsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgY3VycmVudExpc3QgPSB0aGlzLmxpc3QuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC50aXRsZSA9PT0gbGlzdFRpdGxlKTtcbiAgICAgICAgaWYgKGN1cnJlbnRMaXN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50TGlzdC5waWNrUmFuZG9tSXRlbSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCJcbiAgICAgICAgfVxuICAgIH0gXG5cbiAgICBnZXRFcnJvcigpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgIH07XG5cbiAgICBnZXRXYXJuaW5nKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgfTtcblxufVxuaW50ZXJmYWNlIExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG59XG5cblxuZXhwb3J0IGNsYXNzIExJUlBTdWdnZXN0TW9kYWwgZXh0ZW5kcyBTdWdnZXN0TW9kYWw8TElSUFN1Z2dlc3Rpb25JbnRlcmZhY2U+IHtcbiAgICBpdGVtczogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXTtcbiAgICBjYWxsYmFjazogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIFxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBpdGVtczogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXSwgY2FsbGJhY2s6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkKSB7XG4gICAgICBzdXBlcihhcHApO1xuICAgICAgdGhpcy5pdGVtcyA9IGl0ZW1zO1xuICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cblxuICAgIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKChpdGVtKSA9PlxuICAgICAgICAgICAgaXRlbS50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgXG4gICAgcmVuZGVyU3VnZ2VzdGlvbihpdGVtOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZSwgZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6IGl0ZW0udGl0bGUgfSk7XG4gICAgICAgIGVsLmNyZWF0ZUVsKCdzbWFsbCcsIHt0ZXh0OiBpdGVtLmRlc2NyaXB0aW9ufSk7XG4gICAgICB9XG4gIFxuICAgICAgb25DaG9vc2VTdWdnZXN0aW9uKGl0ZW06IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2soaXRlbS50aXRsZSk7XG4gICAgICB9fVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMaXN0SXRlbVJhbmRvbVBpY2tlciBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IExJUlBQbHVnaW5TZXR0aW5ncztcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgICAgICB0aGlzLmFkZFJpYmJvbkljb24oJ2xpc3QtdHJlZScsICdQaWNrIHJhbmRvbSBsaXN0IGl0ZW0nLCAoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRvVGhlSm9iKHRoaXMuc2V0dGluZ3Mubm90ZVBhdGggKyAnLm1kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2luc2VydC1yYW5kb20taXRlbScsXG4gICAgICAgICAgICBuYW1lOiAnSW5zZXJ0IHJhbmRvbSBpdGVtIGZyb20gbGlzdCcsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZG9UaGVKb2IodGhpcy5zZXR0aW5ncy5ub3RlUGF0aCArICcubWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBMSVJQU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuXG4gICAgfVxuXG4gICAgYXN5bmMgZG9UaGVKb2IoZnVsbE5vdGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmdWxsTm90ZVBhdGgpO1xuXG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm90ZSBub3QgZm91bmQhJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdJbnZhbGlkIGZpbGUgdHlwZS4gRXhwZWN0ZWQgYSBNYXJrZG93biBub3RlIGZpbGUuJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZChmaWxlKTtcbiAgICAgICAgY29uc3QgY3VycmVudExJUlAgPSBuZXcgTElSUE5vdGUoKTtcblxuICAgICAgICBjb25zdCBsb2FkU3VjY2VzcyA9IGN1cnJlbnRMSVJQLmxvYWRGcm9tTm90ZShjb250ZW50KTtcbiAgICAgICAgaWYgKCFsb2FkU3VjY2Vzcykge1xuICAgICAgICAgICAgY3VycmVudExJUlAuZXJyb3IuZm9yRWFjaCgoZWxlbWVudCkgPT4gbmV3IE5vdGljZShlbGVtZW50KSk7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBuZXcgTElSUFN1Z2dlc3RNb2RhbCh0aGlzLmFwcCwgY3VycmVudExJUlAuZ2V0TGlzdFN1Z2dlc3Rpb24oKSwgKHRpdGxlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluc2VydFN0cmluZyhjdXJyZW50TElSUC5waWNrUmFuZG9tSXRlbUZyb21MaXN0KHRpdGxlKSk7XG4gICAgICAgIH0pLm9wZW4oKTtcbiAgICB9XG5cbiAgICBpbnNlcnRTdHJpbmcoY3VycmVudFN0cmluZzogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuXG4gICAgICAgIGlmIChhY3RpdmVWaWV3KSB7XG4gICAgICAgICAgICBjb25zdCBlZGl0b3IgPSBhY3RpdmVWaWV3LmVkaXRvcjtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKGN1cnJlbnRTdHJpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3IE5vdGljZShcIk5vIGFjdGl2ZSBNYXJrZG93biBlZGl0b3IgZm91bmQuXCIpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgfVxufVxuXG5jbGFzcyBMSVJQU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIHBsdWdpbjogTGlzdEl0ZW1SYW5kb21QaWNrZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBMaXN0SXRlbVJhbmRvbVBpY2tlcikge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgICAgICAvLyBjb250YWluZXJFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdTZXR0aW5ncyBmb3IgTGlzdCBJdGVtIFJhbmRvbSBQaWNrZXIuJyB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdOb3RlIFBhdGgnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1BhdGggdG8gdGhlIG5vdGUgY29udGFpbmluZyB0aGUgbGlzdHMuJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignRW50ZXIgdGhlIHBhdGggdG8geW91ciBub3RlJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mubm90ZVBhdGgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ub3RlUGF0aCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgfVxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUF5RztBQUV6RyxTQUFTLFlBQWUsU0FBYyxXQUE2RDtBQUMvRixRQUFNLFVBQW9CLENBQUM7QUFDM0IsVUFBUSxRQUFRLENBQUMsU0FBUyxVQUFVO0FBQ2xDLFFBQUksVUFBVSxTQUFTLEtBQUssR0FBRztBQUM3QixjQUFRLEtBQUssS0FBSztBQUFBLElBQ3BCO0FBQUEsRUFDRixDQUFDO0FBQ0QsU0FBTztBQUNUO0FBS0YsSUFBTSxtQkFBdUM7QUFBQSxFQUN6QyxVQUFVO0FBQ2Q7QUFZQSxJQUFNLFdBQU4sTUFBNEM7QUFBQSxFQVF4QyxZQUFZLE9BQWlCO0FBQ3pCLFNBQUssUUFBUSxDQUFDO0FBQ2QsU0FBSyxVQUFVLENBQUM7QUFFaEIsVUFBTSxlQUFlO0FBRXJCLFNBQUssUUFBUSxNQUFNLENBQUMsRUFBRSxRQUFRLGNBQWMsSUFBSTtBQUNoRCxVQUFNLE9BQU8sR0FBRyxDQUFDO0FBQ2pCLFVBQU0scUJBQXFCO0FBQzNCLFVBQU0sbUJBQW1CLFlBQVksT0FBTyxDQUFDLFlBQVksbUJBQW1CLEtBQUssT0FBTyxDQUFDO0FBQ3pGLFFBQUksaUJBQWlCLFdBQVcsR0FBRztBQUMvQixXQUFLLFFBQVEsS0FBSyx1QkFBdUI7QUFFekM7QUFBQSxJQUNKO0FBQ0EsVUFBTSxhQUFhLE1BQU0sSUFBSSxDQUFDLFlBQVk7QUFDdEMsYUFBTyxRQUFRLFFBQVEsb0JBQW9CLElBQUk7QUFBQSxJQUNuRCxDQUFDO0FBQ0QsUUFBSSxpQkFBaUIsQ0FBQyxNQUFNLEdBQUc7QUFFM0IsV0FBSyxjQUFjLFdBQVcsTUFB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QU0sS0FBSyxJQUFJLE1BQU0sV0FBVyxJQUFJO0FBQ3BELFVBQU0sY0FBYyxJQUFJLFNBQVM7QUFFakMsVUFBTSxjQUFjLFlBQVksYUFBYSxPQUFPO0FBQ3BELFFBQUksQ0FBQyxhQUFhO0FBQ2Qsa0JBQVksTUFBTSxRQUFRLENBQUMsWUFBWSxJQUFJLHVCQUFPLE9BQU8sQ0FBQztBQUMxRDtBQUFBLElBQ0o7QUFDQSxRQUFJLGlCQUFpQixLQUFLLEtBQUssWUFBWSxrQkFBa0IsR0FBRyxDQUFDLFVBQVU7QUFDdkUsV0FBSyxhQUFhLFlBQVksdUJBQXVCLEtBQUssQ0FBQztBQUFBLElBQy9ELENBQUMsRUFBRSxLQUFLO0FBQUEsRUFDWjtBQUFBLEVBRUEsYUFBYSxlQUE2QjtBQUN0QyxVQUFNLGFBQWEsS0FBSyxJQUFJLFVBQVUsb0JBQW9CLDRCQUFZO0FBRXRFLFFBQUksWUFBWTtBQUNaLFlBQU0sU0FBUyxXQUFXO0FBQzFCLFlBQU0sWUFBWSxPQUFPLGFBQWE7QUFDdEMsYUFBTyxpQkFBaUIsYUFBYTtBQUFBLElBQ3pDLE9BQU87QUFDSCxVQUFJLHVCQUFPLGtDQUFrQztBQUFBLElBQ2pEO0FBQUEsRUFFSjtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ2pCLFNBQUssV0FBVyxPQUFPLE9BQU8sQ0FBQyxHQUFHLGtCQUFrQixNQUFNLEtBQUssU0FBUyxDQUFDO0FBQUEsRUFDN0U7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNqQixVQUFNLEtBQUssU0FBUyxLQUFLLFFBQVE7QUFBQSxFQUNyQztBQUNKO0FBRUEsSUFBTSxpQkFBTixjQUE2QixpQ0FBaUI7QUFBQSxFQUcxQyxZQUFZLEtBQVUsUUFBOEI7QUFDaEQsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDbEI7QUFBQSxFQUVBLFVBQWdCO0FBQ1osVUFBTSxFQUFFLFlBQVksSUFBSTtBQUV4QixnQkFBWSxNQUFNO0FBSWxCLFFBQUksd0JBQVEsV0FBVyxFQUNsQixRQUFRLFdBQVcsRUFDbkIsUUFBUSx3Q0FBd0MsRUFDaEQsUUFBUSxVQUFRLEtBQ1osZUFBZSw2QkFBNkIsRUFDNUMsU0FBUyxLQUFLLE9BQU8sU0FBUyxRQUFRLEVBQ3RDLFNBQVMsT0FBTyxVQUFVO0FBQ3ZCLFdBQUssT0FBTyxTQUFTLFdBQVc7QUFDaEMsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ25DLENBQUMsQ0FBQztBQUFBLEVBQ2Q7QUFDSjsiLAogICJuYW1lcyI6IFtdCn0K
