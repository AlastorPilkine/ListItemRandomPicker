/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  MySuggestModal: () => MySuggestModal,
  default: () => ListItemRandomPicker
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  notePath: "Full path of a note"
};
var MySuggestModal = class extends import_obsidian.SuggestModal {
  constructor(app, items, callback) {
    super(app);
    this.items = items;
    this.callback = callback;
  }
  getSuggestions(query) {
    return this.items.filter(
      (item) => item.title.toLowerCase().includes(query.toLowerCase())
    );
  }
  renderSuggestion(item, el) {
    el.createEl("div", { text: item.title });
  }
  onChooseSuggestion(item, evt) {
    this.callback(item.title);
  }
};
var ListItemRandomPicker = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("list-tree", "Pick random list item", (evt) => {
      this.openTitlePicker(this.settings.notePath);
    });
    this.addSettingTab(new LIRPSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  transformerEnSuggestions(strings) {
    return strings.map((str) => ({
      title: str,
      description: ""
    }));
  }
  async openTitlePicker(notePath) {
    const fullNotePath = notePath + ".md";
    const file = this.app.vault.getAbstractFileByPath(fullNotePath);
    if (!file) {
      new import_obsidian.Notice("Note not found!");
      return;
    }
    if (!(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice("Invalid file type. Expected a TFile.");
      return;
    }
    const content = await this.app.vault.read(file);
    const titles = this.getTitlesFromNote(content);
    if (titles.length === 0) {
      new import_obsidian.Notice("No titles found in the note!");
      return;
    }
    new MySuggestModal(this.app, this.transformerEnSuggestions(titles), (title) => {
      this.insertRandomEntry(content, title);
    }).open();
  }
  getTitlesFromNote(content) {
    const titleRegex = /^#+\s+(.+)$/gm;
    const titles = [];
    let match;
    while ((match = titleRegex.exec(content)) !== null) {
      titles.push(match[1]);
    }
    return titles;
  }
  async insertRandomEntry(content, title) {
    const entries = this.getEntriesFromNote(content, title);
    if (entries.length === 0) {
      new import_obsidian.Notice("No entries found for this title!");
      return;
    }
    const randomEntry = entries[Math.floor(Math.random() * entries.length)].replace(/\n/g, "");
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (activeView) {
      const editor = activeView.editor;
      const selection = editor.getSelection();
      editor.replaceSelection(randomEntry);
    } else {
      new import_obsidian.Notice("No active Markdown editor found.");
    }
  }
  getEntriesFromNote(content, title) {
    const titleRegex = new RegExp(`^#+\\s+${title}$`, "m");
    const titleMatch = titleRegex.exec(content);
    if (!titleMatch) {
      return [];
    }
    const startIndex = titleMatch.index + titleMatch[0].length;
    let endIndex = content.indexOf("\n#", startIndex);
    if (endIndex === -1) {
      endIndex = content.length;
    }
    const listItemRegex = /^(-|\d+\.) +(.+)$/gm;
    const entries = [];
    let currentEntry;
    let currentEntrySplit;
    let repeat;
    let itemString;
    const listContent = content.substring(startIndex, endIndex);
    while ((currentEntry = listItemRegex.exec(listContent)) !== null) {
      let fullString = currentEntry[2];
      const itemWithNumberRegEx = /^\((\d+)\)\s+(.+)$/m;
      if ((currentEntrySplit = itemWithNumberRegEx.exec(fullString)) !== null) {
        repeat = Number(currentEntrySplit[1]);
        itemString = currentEntrySplit[2];
      } else {
        repeat = 1;
        itemString = fullString;
      }
      for (let i = 0; i < repeat; i++) {
        entries.push(itemString);
      }
    }
    return entries;
  }
};
var LIRPSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Note Path").setDesc("Path to the note containing the lists.").addText((text) => text.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async (value) => {
      this.plugin.settings.notePath = value;
      await this.plugin.saveSettings();
    }));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgU3VnZ2VzdE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcblxuaW50ZXJmYWNlIExJUlBQbHVnaW5TZXR0aW5ncyB7XG4gICAgbm90ZVBhdGg6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTElSUFBsdWdpblNldHRpbmdzID0ge1xuICAgIG5vdGVQYXRoOiAnRnVsbCBwYXRoIG9mIGEgbm90ZSdcbn07XG5cbmludGVyZmFjZSBMSVJQTGlzdEludGVyZmFjZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGhpZGRlbjogYm9vbGVhbjtcbiAgICBpdGVtczogc3RyaW5nW107XG4gICAgcGlja1JhbmRvbUl0ZW0oKTogc3RyaW5nO1xufVxuXG5jbGFzcyBMSVJQTGlzdCBpbXBsZW1lbnRzIExJUlBMaXN0SW50ZXJmYWNlIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgaGlkZGVuOiBib29sZWFuO1xuICAgIGl0ZW1zOiBzdHJpbmdbXTtcblxuICAgIGNvbnN0cnVjdG9yKG11bHRpTGluZVN0cmluZzogc3RyaW5nKSB7XG4gICAgICAgIC8vIFdvcmsgdG8gZG9cbiAgICB9XG5cbiAgICBwaWNrUmFuZG9tSXRlbSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gXCJ0b3RvXCJcbiAgICB9XG5cbn1cbmludGVyZmFjZSBMSVJQTm90ZUludGVyZmFjZSB7XG4gICAgZnVsbFBhdGg6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGxpc3Q6IExJUlBMaXN0W107XG4gICAgbG9hZEZyb21Ob3RlKG5vdGVGdWxsUGF0aDogc3RyaW5nKTogYm9vbGVhbjtcbiAgICBnZXRMaXN0U3VnZ2VzdGlvbigpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdO1xuICAgIHBpY2tSYW5kb21JdGVtRnJvbUxpc3RsaXN0KGxpc3RUaXRsZTogc3RyaW5nKTogc3RyaW5nOyBcbn1cblxuY2xhc3MgTElSUE5vdGUgaW1wbGVtZW50cyBMSVJQTm90ZUludGVyZmFjZSB7XG4gICAgZnVsbFBhdGg6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGxpc3Q6IExJUlBMaXN0W107XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICAgIHRoaXMuZnVsbFBhdGggPSBcIlwiO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgfVxuXG4gICAgbG9hZEZyb21Ob3RlKG5vdGVGdWxsUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgZ2V0TGlzdFN1Z2dlc3Rpb24oKTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXSB7XG4gICAgICAgIGNvbnN0IGV4ZW1wbGUgPSB7XG4gICAgICAgICAgICB0aXRsZTogXCJ0b3RvXCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJcIlxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhcnJheSA9IFtleGVtcGxlXTtcbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIHBpY2tSYW5kb21JdGVtRnJvbUxpc3RsaXN0KGxpc3RUaXRsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFwidG90b1wiXG4gICAgfSBcblxufVxuaW50ZXJmYWNlIExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG59XG5cblxuZXhwb3J0IGNsYXNzIE15U3VnZ2VzdE1vZGFsIGV4dGVuZHMgU3VnZ2VzdE1vZGFsPExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlPiB7XG4gICAgaXRlbXM6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW107XG4gICAgY2FsbGJhY2s6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkO1xuICBcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgaXRlbXM6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW10sIGNhbGxiYWNrOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZCkge1xuICAgICAgc3VwZXIoYXBwKTtcbiAgICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcbiAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICBnZXRTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2VbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcigoaXRlbSkgPT5cbiAgICAgICAgICBpdGVtLnRpdGxlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICBcbiAgICByZW5kZXJTdWdnZXN0aW9uKGl0ZW06IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlLCBlbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgZWwuY3JlYXRlRWwoJ2RpdicsIHsgdGV4dDogaXRlbS50aXRsZSB9KTtcbiAgICAgIH1cbiAgXG4gICAgICBvbkNob29zZVN1Z2dlc3Rpb24oaXRlbTogTElSUFN1Z2dlc3Rpb25JbnRlcmZhY2UsIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFjayhpdGVtLnRpdGxlKTtcbiAgICAgIH19ICBcblxuY2xhc3MgSXRlbVBpY2tlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGl0ZW1zOiBzdHJpbmdbXTtcbiAgICBjYWxsYmFjazogKGl0ZW06IHN0cmluZykgPT4gdm9pZDtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBpdGVtczogc3RyaW5nW10sIGNhbGxiYWNrOiAoaXRlbTogc3RyaW5nKSA9PiB2b2lkKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG5cbiAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBkdSBjb250ZW5ldXIgRmxleGJveFxuICAgICAgICBjb250ZW50RWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgY29udGVudEVsLnN0eWxlLmZsZXhEaXJlY3Rpb24gPSAnY29sdW1uJztcbiAgICAgICAgY29udGVudEVsLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsgLy8gQXNzdXJlei12b3VzIHF1ZSBsZSBjb250ZW5ldXIgcHJlbmQgdG91dGUgbGEgaGF1dGV1clxuXG4gICAgICAgIC8vIENvbnRlbmV1ciBwb3VyIGxlIHNcdTAwRTlsZWN0ZXVyIChwcmVuZHJhIGwnZXNwYWNlIHJlc3RhbnQpXG4gICAgICAgIGNvbnN0IHNlbGVjdENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgc2VsZWN0Q29udGFpbmVyLnN0eWxlLmZsZXhHcm93ID0gJzEnOyAvLyBQcmVuZCBsJ2VzcGFjZSBkaXNwb25pYmxlXG4gICAgICAgIHNlbGVjdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICBzZWxlY3RDb250YWluZXIuc3R5bGUuZmxleERpcmVjdGlvbiA9ICdjb2x1bW4nO1xuICAgICAgICBzZWxlY3RDb250YWluZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnY2VudGVyJzsgLy8gQ2VudHJlIHZlcnRpY2FsZW1lbnQgbGUgc2VsZWN0XG4gICAgICAgIHNlbGVjdENvbnRhaW5lci5zdHlsZS5hbGlnbkl0ZW1zID0gJ2NlbnRlcic7IC8vIENlbnRyZSBob3Jpem9udGFsZW1lbnQgbGUgc2VsZWN0XG5cbiAgICAgICAgY29uc3QgaXRlbVNlbGVjdCA9IHNlbGVjdENvbnRhaW5lci5jcmVhdGVFbCgnc2VsZWN0Jyk7XG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGl0ZW1TZWxlY3QuY3JlYXRlRWwoJ29wdGlvbicsIHsgdmFsdWU6IGl0ZW0sIHRleHQ6IGl0ZW0gfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENvbnRlbmV1ciBwb3VyIGxlIGJvdXRvbiAoZW4gYmFzLCBjZW50clx1MDBFOSlcbiAgICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdigpO1xuICAgICAgICBidXR0b25Db250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgYnV0dG9uQ29udGFpbmVyLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ2NlbnRlcic7IC8vIENlbnRyZSBob3Jpem9udGFsZW1lbnQgbGUgYm91dG9uXG4gICAgICAgIGJ1dHRvbkNvbnRhaW5lci5zdHlsZS5wYWRkaW5nID0gJzEwcHggMCc7IC8vIEFqb3V0ZSB1biBwZXUgZCdlc3BhY2UgYXV0b3VyIGR1IGJvdXRvblxuXG4gICAgICAgIGNvbnN0IG9rQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IHRleHQ6ICdPSycgfSk7XG4gICAgICAgIG9rQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0gaXRlbVNlbGVjdC52YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2soc2VsZWN0ZWRJdGVtKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25DbG9zZSgpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGlzdEl0ZW1SYW5kb21QaWNrZXIgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIHNldHRpbmdzOiBMSVJQUGx1Z2luU2V0dGluZ3M7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdsaXN0LXRyZWUnLCAnUGljayByYW5kb20gbGlzdCBpdGVtJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vcGVuVGl0bGVQaWNrZXIodGhpcy5zZXR0aW5ncy5ub3RlUGF0aCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTElSUFNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcblxuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cblxuICAgIHRyYW5zZm9ybWVyRW5TdWdnZXN0aW9ucyhzdHJpbmdzOiBzdHJpbmdbXSk6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW10ge1xuICAgICAgICByZXR1cm4gc3RyaW5ncy5tYXAoc3RyID0+ICh7XG4gICAgICAgICAgdGl0bGU6IHN0cixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJcIlxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICBcbiAgICBhc3luYyBvcGVuVGl0bGVQaWNrZXIobm90ZVBhdGg6IHN0cmluZykge1xuICAgICAgICBjb25zdCBmdWxsTm90ZVBhdGggPSBub3RlUGF0aCArICcubWQnO1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZ1bGxOb3RlUGF0aCk7XG5cbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdOb3RlIG5vdCBmb3VuZCEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0ludmFsaWQgZmlsZSB0eXBlLiBFeHBlY3RlZCBhIFRGaWxlLicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgIGNvbnN0IHRpdGxlcyA9IHRoaXMuZ2V0VGl0bGVzRnJvbU5vdGUoY29udGVudCk7XG5cbiAgICAgICAgaWYgKHRpdGxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIHRpdGxlcyBmb3VuZCBpbiB0aGUgbm90ZSEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBuZXcgTXlTdWdnZXN0TW9kYWwodGhpcy5hcHAsIHRoaXMudHJhbnNmb3JtZXJFblN1Z2dlc3Rpb25zKHRpdGxlcyksICh0aXRsZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRSYW5kb21FbnRyeShjb250ZW50LCB0aXRsZSk7XG4gICAgICAgIH0pLm9wZW4oKTtcbiAgICAgICAgXG5cbiAgICAgICAgLy8gbmV3IEl0ZW1QaWNrZXJNb2RhbCh0aGlzLmFwcCwgdGl0bGVzLCAodGl0bGUpID0+IHtcbiAgICAgICAgLy8gICAgIHRoaXMuaW5zZXJ0UmFuZG9tRW50cnkoY29udGVudCwgdGl0bGUpO1xuICAgICAgICAvLyB9KS5vcGVuKCk7XG4gICAgfVxuXG4gICAgZ2V0VGl0bGVzRnJvbU5vdGUoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCB0aXRsZVJlZ2V4ID0gL14jK1xccysoLispJC9nbTtcbiAgICAgICAgY29uc3QgdGl0bGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBsZXQgbWF0Y2g7XG4gICAgICAgIHdoaWxlICgobWF0Y2ggPSB0aXRsZVJlZ2V4LmV4ZWMoY29udGVudCkpICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aXRsZXMucHVzaChtYXRjaFsxXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRpdGxlcztcbiAgICB9XG5cbiAgICBhc3luYyBpbnNlcnRSYW5kb21FbnRyeShjb250ZW50OiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcpIHtcblxuICAgICAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5nZXRFbnRyaWVzRnJvbU5vdGUoY29udGVudCwgdGl0bGUpO1xuXG4gICAgICAgIGlmIChlbnRyaWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm8gZW50cmllcyBmb3VuZCBmb3IgdGhpcyB0aXRsZSEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21FbnRyeSA9IGVudHJpZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZW50cmllcy5sZW5ndGgpXS5yZXBsYWNlKC9cXG4vZywgJycpO1xuICAgICAgICAvLyBjb25zdCByYW5kb21FbnRyeSA9IGVudHJpZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZW50cmllcy5sZW5ndGgpXS50cmltKCk7XG5cbiAgICAgICAgY29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG5cbiAgICAgICAgaWYgKGFjdGl2ZVZpZXcpIHtcbiAgICAgICAgICAgIGNvbnN0IGVkaXRvciA9IGFjdGl2ZVZpZXcuZWRpdG9yO1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24ocmFuZG9tRW50cnkpO1xuICAgICAgICAgICAgLy8gY29uc3QgcG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgICAgICAgICAvLyBlZGl0b3IucmVwbGFjZVJhbmdlKHJhbmRvbUVudHJ5LCBwb3NpdGlvbik7IC8vLCBwb3NpdGlvbik7XG5cbiAgICAgICAgICAgIC8vIC8vIERcdTAwRTlwbGFjZXIgbGUgY3Vyc2V1ciBcdTAwRTAgbGEgZmluIGRlIGwnaW5zZXJ0aW9uXG4gICAgICAgICAgICAvLyBjb25zdCBuZXdQb3NpdGlvbiA9IHsgbGluZTogcG9zaXRpb24ubGluZSwgY2g6IHBvc2l0aW9uLmNoICsgcmFuZG9tRW50cnkubGVuZ3RoIH07XG4gICAgICAgICAgICAvLyBlZGl0b3Iuc2V0Q3Vyc29yKG5ld1Bvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJObyBhY3RpdmUgTWFya2Rvd24gZWRpdG9yIGZvdW5kLlwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldEVudHJpZXNGcm9tTm90ZShjb250ZW50OiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IHRpdGxlUmVnZXggPSBuZXcgUmVnRXhwKGBeIytcXFxccyske3RpdGxlfSRgLCAnbScpO1xuICAgICAgICBjb25zdCB0aXRsZU1hdGNoID0gdGl0bGVSZWdleC5leGVjKGNvbnRlbnQpO1xuXG4gICAgICAgIGlmICghdGl0bGVNYXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IHRpdGxlTWF0Y2guaW5kZXggKyB0aXRsZU1hdGNoWzBdLmxlbmd0aDtcbiAgICAgICAgbGV0IGVuZEluZGV4ID0gY29udGVudC5pbmRleE9mKCdcXG4jJywgc3RhcnRJbmRleCk7XG4gICAgICAgIGlmIChlbmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGVuZEluZGV4ID0gY29udGVudC5sZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsaXN0SXRlbVJlZ2V4ID0gL14oLXxcXGQrXFwuKSArKC4rKSQvZ207XG4gICAgICAgIGNvbnN0IGVudHJpZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGxldCBjdXJyZW50RW50cnk7XG4gICAgICAgIGxldCBjdXJyZW50RW50cnlTcGxpdDtcbiAgICAgICAgbGV0IHJlcGVhdDogbnVtYmVyO1xuICAgICAgICBsZXQgaXRlbVN0cmluZzogc3RyaW5nO1xuICAgICAgICBjb25zdCBsaXN0Q29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICAgICAgd2hpbGUgKChjdXJyZW50RW50cnkgPSBsaXN0SXRlbVJlZ2V4LmV4ZWMobGlzdENvbnRlbnQpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IGZ1bGxTdHJpbmcgPSBjdXJyZW50RW50cnlbMl07XG4gICAgICAgICAgICBjb25zdCBpdGVtV2l0aE51bWJlclJlZ0V4ID0gL15cXCgoXFxkKylcXClcXHMrKC4rKSQvbTtcbiAgICAgICAgICAgIGlmICgoY3VycmVudEVudHJ5U3BsaXQgPSBpdGVtV2l0aE51bWJlclJlZ0V4LmV4ZWMoZnVsbFN0cmluZykpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVwZWF0ID0gTnVtYmVyKGN1cnJlbnRFbnRyeVNwbGl0WzFdKTtcbiAgICAgICAgICAgICAgICBpdGVtU3RyaW5nID0gY3VycmVudEVudHJ5U3BsaXRbMl07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcGVhdCA9IDE7XG4gICAgICAgICAgICAgICAgaXRlbVN0cmluZyA9IGZ1bGxTdHJpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcGVhdDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZW50cmllcy5wdXNoKGl0ZW1TdHJpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbnRyaWVzO1xuICAgIH1cbn1cblxuY2xhc3MgTElSUFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBwbHVnaW46IExpc3RJdGVtUmFuZG9tUGlja2VyO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTGlzdEl0ZW1SYW5kb21QaWNrZXIpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAgICAgLy8gY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU2V0dGluZ3MgZm9yIExpc3QgSXRlbSBSYW5kb20gUGlja2VyLicgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnTm90ZSBQYXRoJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdQYXRoIHRvIHRoZSBub3RlIGNvbnRhaW5pbmcgdGhlIGxpc3RzLicpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0VudGVyIHRoZSBwYXRoIHRvIHlvdXIgbm90ZScpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm5vdGVQYXRoKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mubm90ZVBhdGggPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBeUc7QUFNekcsSUFBTSxtQkFBdUM7QUFBQSxFQUN6QyxVQUFVO0FBQ2Q7QUFxRU8sSUFBTSxpQkFBTixjQUE2Qiw2QkFBc0M7QUFBQSxFQUl0RSxZQUFZLEtBQVUsT0FBa0MsVUFBbUM7QUFDekYsVUFBTSxHQUFHO0FBQ1QsU0FBSyxRQUFRO0FBQ2IsU0FBSyxXQUFXO0FBQUEsRUFDbEI7QUFBQSxFQUVBLGVBQWUsT0FBMEM7QUFDckQsV0FBTyxLQUFLLE1BQU07QUFBQSxNQUFPLENBQUMsU0FDeEIsS0FBSyxNQUFNLFlBQVksRUFBRSxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBQUEsSUFDdkQ7QUFBQSxFQUNGO0FBQUEsRUFFRixpQkFBaUIsTUFBK0IsSUFBaUI7QUFDN0QsT0FBRyxTQUFTLE9BQU8sRUFBRSxNQUFNLEtBQUssTUFBTSxDQUFDO0FBQUEsRUFDekM7QUFBQSxFQUVBLG1CQUFtQixNQUErQixLQUFpQztBQUNqRixTQUFLLFNBQVMsS0FBSyxLQUFLO0FBQUEsRUFDMUI7QUFBQztBQXFEUCxJQUFxQix1QkFBckIsY0FBa0QsdUJBQU87QUFBQSxFQUdyRCxNQUFNLFNBQVM7QUFDWCxVQUFNLEtBQUssYUFBYTtBQUV4QixTQUFLLGNBQWMsYUFBYSx5QkFBeUIsQ0FBQyxRQUFvQjtBQUMxRSxXQUFLLGdC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
