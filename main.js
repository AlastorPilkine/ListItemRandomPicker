/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var P=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var A=(h,i)=>{for(var e in i)P(h,e,{get:i[e],enumerable:!0})},M=(h,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of D(i))!C.call(h,s)&&s!==e&&P(h,s,{get:()=>i[s],enumerable:!(t=V(i,s))||t.enumerable});return h};var W=h=>M(P({},"__esModule",{value:!0}),h);var H={};A(H,{LIRPSuggestModal:()=>N,default:()=>v});module.exports=W(H);var g=require("obsidian");function k(h,i){let e=[];return h.forEach((t,s)=>{i(t,s)&&e.push(s)}),e}function B(h,i,e=!1){let t=!1;if(e&&i.length%2!==0&&h>=i[i.length-1])return!0;for(let s=0;s<i.length-2;s=s+2)if(i[s]<=h&&h<=i[s+1])return!0;return t}function T(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var E=class{checkDice(i){return/^(\d+)?d(\d+)([\+\-]\d+)?(e)?(k\d+)?(kl\d+)?$/i.test(i)}rollDice(i){if(!this.checkDice(i))throw new Error("Syntaxe de lancer de d\xE9s invalide.");let[e,t,s,n,l,o,r]=i.match(/^(\d+)?d(\d+)([\+\-]\d+)?(e)?(k\d+)?(kl\d+)?$/i),c=parseInt(t||"1"),p=parseInt(s),w=parseInt(n||"0"),m=!!l,a=o?parseInt(o.slice(1)):void 0,u=r?parseInt(r.slice(2)):void 0,d=[];for(let f=0;f<c;f++){let L=Math.floor(Math.random()*p)+1;if(d.push(L),m)for(;L===p;)L=Math.floor(Math.random()*p)+1,d.push(L)}return a?(d.sort((f,L)=>L-f),d=d.slice(0,a)):u&&(d.sort((f,L)=>f-L),d=d.slice(0,u)),d.reduce((f,L)=>f+L,0)+w}replaceDiceRolls(i,e,t){let s=new RegExp(`${this.escapeRegExp(e)}([^${this.escapeRegExp(e+t)}]+)${this.escapeRegExp(t)}`,"g");return i.replace(s,(n,l)=>{try{return this.rollDice(l).toString()}catch(o){return n}})}escapeRegExp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},O=["dupInNote","dupInFolder","emptyList","emptyNote","refLimit","subRefLimit","pathSetting","folderAndFile","showItem","noActiveView"],b=class{static getErrorStatus(){return["dupInFolder","pathSetting"]}static getWarningStatus(){let i=[];return O.map(e=>{!b.getErrorStatus().contains(e)&&!b.getWarningStatus().contains(e)&&i.push(e)}),i}static getInfoStatus(){return["showItem","refLimit","subRefLimit"]}getType(){return["pathSetting","dupInFolder"].contains(this.status)?"error":"warning"}constructor(i,e,t,s=""){this.father=i,this.child=e,this.status=t,this.complement=s}toString(){return`${this.getType()} / ${this.father} / ${this.child} / ${this.status} / ${this.complement}`}},x=class{constructor(){this.logs=[]}push(i,e,t,s=""){this.logs.push(new b(i,e,t,s))}add(i){this.logs=this.logs.concat(i.logs)}get(i){let e=this.logs.filter(s=>s.getType()===i),t=[];return e.map(s=>{t.push(s.toString())}),t}flush(){this.logs=[]}},S=class{static getSettingString(i=""){if(i==="")return`- [ ] Hide this list
`;switch(i){case"hide":return"^- \\[[x \\?]\\] Hide this list$";case"hide_string":return"- \\[[x ?]\\] Hide this list";case"hide_ticked":return"^- \\[[x?]\\] Hide this list$"}}constructor(i,e,t,s,n){this.title="",this.description="",this.hidden=!1,this.items=[],this.logs=new x,this.nullValue=t,this.escapeString=s,this.commentString=n;let l=/^# +(.+)$/;this.title=e[0].replace(l,"$1"),e.shift();let o=`^(?!${S.getSettingString("hide_string")}) {0,3}(-|\\d+.|\\*) +(.+)$`,r=new RegExp(o),c=k(e,a=>r.test(a));if(c.length===0){this.logs.push(i,this.title,"emptyList"),this.hidden=!0;return}let p=e.map(a=>a.replace(r,"$2"));if(c[0]!==0){let a=p.slice(0,c[0]);a[0]===""&&a.shift();let u=!1,d=new RegExp(S.getSettingString("hide_ticked")),$=new RegExp(S.getSettingString("hide"));a.map(f=>{d.test(f)&&(u=!0,this.hidden=u)}),a=a.filter(f=>!$.test(f)),this.description=a.join(`
`)}else this.description="";let w=c.length,m;for(let a=0;a<w-1;a++)m=p.slice(c[a],c[a+1]),this.pushItemBasedOnWeight(m);m=p.slice(c[w-1]),m.at(-1)===""&&m.pop(),this.pushItemBasedOnWeight(m)}flushLogs(){this.logs.flush()}pushItemBasedOnWeight(i){let e=/^\((\d+)\)\s+(.+)$/,t,s;(t=e.exec(i[0]))!==null?(s=Number(t[1]),i[0]=t[2]):s=1,i[0]===this.nullValue&&(i.length===1?i[0]="":i.shift());let n=`^ *${this.escapeString}(.*)`,l=new RegExp(n,"gm"),r=i.map(c=>c.replace(l,"$1")).join(`
`);for(let c=0;c<s;c++)this.items.push(r)}getSuggestion(i){return{noteName:i,title:this.title,description:this.description.split(`
`)[0]}}notHidden(){return!this.hidden}pickRandomItem(){let i="";return this.items.length>0&&(i=this.items[Math.floor(Math.random()*this.items.length)]),i}getLogs(){return this.logs}get length(){return this.items.length}},R=class{static getSettingString(i=""){if(i==="")return`- [ ] Do not preserve comments
`;switch(i){case"deleteComment":return"^- \\[[x ?]\\] Do not preserve comments$";case"deleteComment_ticked":return"^- \\[[x?]\\] Do not preserve comments$"}}constructor(i,e,t,s){this.noteName="",this.description="",this.list=[],this.logs=new x,this.nullValue=i,this.escapeString=e,this.commentString=t,this.rollDice=!0,this.referenceMaxDepth=s,this.keepComment=!0}getListTitles(){let i=[];return this.list.map(e=>{i.push(e.title)}),i}workWithComment(i){let e=new RegExp(R.getSettingString("deleteComment_ticked")),t=/^# .+$/,s=`^${this.commentString}$`,n=new RegExp(s),l=`${this.commentString}.*?${this.commentString}`,o=new RegExp(l),r=i.split(`
`),c=k(r,u=>e.test(u)),p=k(r,u=>n.test(u)),w=k(r,u=>t.test(u));if(w.length===0)return i;c.length===0||c[0]>w[0]?this.keepComment=!0:this.keepComment=B(c[0],p);let m=!1,a=[];return r.map(u=>{let d=!1;n.test(u)&&(m=!m,d=!0),m||d?this.keepComment&&a.push(this.escapeString+u):this.keepComment?a.push(u):a.push(u.replace(o,""))}),a.join(`
`)}loadFromNote(i,e){this.noteName=i;let t=[];t=this.workWithComment(e).split(`
`),t[0]===""&&t.shift();let s=/^# .+$/,n=k(t,r=>s.test(r));if(n.length===0)return this.logs.push(i,"","emptyNote"),!1;if(n[0]!==0){let r=t.slice(0,n[0]),c=new RegExp(R.getSettingString("deleteComment"));r=r.filter(p=>!c.test(p)),this.description=r.join(`
`)}let l=n.length,o=!0;for(let r=0;r<l-1;r++)o=this.pushListIfNotExists(new S(this.noteName,t.slice(n[r],n[r+1]),this.nullValue,this.escapeString,this.commentString))&&o;return o=this.pushListIfNotExists(new S(this.noteName,t.slice(n[l-1]),this.nullValue,this.escapeString,this.commentString))&&o,o}pushListIfNotExists(i){return this.getListTitles().contains(i.title)?(this.logs.push(this.noteName,i.title,"dupInNote"),!1):(this.list.push(i),!0)}getListSuggestion(i=!1){let e=new I;return this.list.forEach(t=>{(i||t.notHidden())&&e.push(t.getSuggestion(this.noteName))}),e}doReferenceSubstitution(i){let e,t=i,s="",n=`{(${this.list.map(l=>T(l.title)).join("|")})}`;for(let l=0;l<this.referenceMaxDepth;l++){let o=new RegExp(n,"mg");for(;(e=o.exec(t))!==null;){let r=this.pickRandomItemFromList(e[1],!1);s=e[0],t=t.replace(s,r),o.lastIndex=e.index+r.length}}return this.rollDice&&(t=new E().replaceDiceRolls(t,"{","}")),{lastListTitle:s,modifiedText:t}}flushLogs(){this.logs.flush(),this.list.map(i=>{i.flushLogs()})}pickRandomItemFromList(i,e=!0){let t="",s={lastListTitle:i,modifiedText:""},n=this.list.find(l=>l.title===i);if(n!==void 0){if(t=n.pickRandomItem(),e){s=this.doReferenceSubstitution(t),t=s.modifiedText;let l=`{(${this.list.map(r=>T(r.title)).join("|")})}`;new RegExp(l).test(t)&&e&&(s.lastListTitle===""&&(s.lastListTitle=i),this.logs.push(this.noteName,s.lastListTitle,"refLimit"))}return t}else return""}getLogs(){let i=new x;return i.add(this.logs),this.list.map(e=>{i.add(e.getLogs())}),i}get length(){return this.list.length}},F=class{constructor(i,e,t,s){this.multiNote=[],this.nullValue=i,this.escapeString=e,this.commentString=t,this.referenceMaxDepth=s,this.logs=new x}loadFromNote(i,e){let t=new R(this.nullValue,this.escapeString,this.commentString,this.referenceMaxDepth),s=t.loadFromNote(i,e);return s=this.pushNoteIfListNotExists(t)&&s,s}pushNoteIfListNotExists(i){let e=this.getListTitles(),t=!0;return i.getListTitles().map(s=>{e.contains(s)&&(this.logs.push(i.noteName,s,"dupInFolder",this.getNoteNameFromListTitle(s)),t=!1)}),t?this.multiNote.push(i):this.logs.add(i.logs),t}getNoteNameFromListTitle(i){let e=this.multiNote.find(t=>t.getListTitles().contains(i));return e!==void 0?e.noteName:""}getListTitles(){let i=[];return this.multiNote.map(e=>{i=i.concat(e.getListTitles())}),i}getListSuggestion(i=!1){let e=new I;return this.multiNote.map(t=>{e=e.concat(t.getListSuggestion(i))}),e}getNoteSuggestion(i=!1){let e=new I;return this.multiNote.map(t=>{t.getListSuggestion(i).length>0&&e.push({noteName:t.noteName,title:t.noteName,description:t.description.split(`
`)[0]})}),e}doReferenceSubstitution(i){let e=new R(this.nullValue,this.escapeString,this.commentString,this.referenceMaxDepth);this.multiNote.map(o=>{e.list=e.list.concat(o.list)});let t={lastListTitle:"Reference substitution in selection",modifiedText:""};t=e.doReferenceSubstitution(i);let s="",n=`{(${e.list.map(o=>T(o.title)).join("|")})}`;return new RegExp(n).test(t.modifiedText)&&this.logs.push("","","subRefLimit"),t.modifiedText}pickRandomItemFromList(i,e=!0){let t=new R(this.nullValue,this.escapeString,this.commentString,this.referenceMaxDepth);t.noteName=this.getNoteNameFromListTitle(i),this.multiNote.map(n=>{t.list=t.list.concat(n.list)});let s=t.pickRandomItemFromList(i);return this.logs.add(t.getLogs()),s}flushLogs(){this.logs.flush(),this.multiNote.map(i=>{i.flushLogs()})}getLogs(){let i=new x;return i.add(this.logs),this.multiNote.map(e=>{i.add(e.getLogs())}),i}hasErrors(){return this.getLogs().get("error").length!==0}get length(){return this.multiNote.length}},I=class{constructor(){this.list=[]}push(i){this.list.push(i)}filterByNoteName(i){let e=new I;return this.list.map(t=>{t.noteName===i&&e.push(t)}),e}filter(i){let e=new I;for(let t=0;t<this.list.length;t++)i(this.list[t],t,this.list)&&e.push(this.list[t]);return e}concat(i){let e=new I;return e.list=this.list.concat(i.list),e}get length(){return this.list.length}},N=class extends g.SuggestModal{constructor(e,t,s){super(e);this.items=t,this.callback=s}getSuggestions(e){return this.items.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())).list}renderSuggestion(e,t){t.createEl("div",{text:e.title});let s=e.description;t.createEl("small",{text:s})}onChooseSuggestion(e,t){this.callback(e)}},j={notePath:"Note or folder path",nullValue:"null",escapeValue:"//",selectionForNotification:"!",showNoteSelector:!0,showWarning:!0,deleteSelectionForNotification:!1,maxReferenceDepth:3,commentValue:"%%"},v=class extends g.Plugin{async onload(){await this.loadSettings(),this.logs=new x,this.addRibbonIcon("list-tree","Pick random list item",e=>{this.prepareAction("note")}),this.addCommand({id:"insert-random-item",name:"Insert random item from list",callback:()=>{this.prepareAction("note")}}),this.addCommand({id:"insert-list-setting-item",name:"Insert list settings values",callback:()=>{this.insertString(S.getSettingString())}}),this.addCommand({id:"insert-note-setting-item",name:"Insert note settings values",callback:()=>{this.insertString(R.getSettingString())}}),this.addCommand({id:"insert-reference-item",name:"Insert list reference",callback:()=>{this.prepareAction("reference")}}),this.addCommand({id:"replace-reference-item",name:"Replace references in selection",callback:()=>{this.prepareAction("doRefSubstitution")}}),this.addSettingTab(new y(this.app,this))}onunload(){}getLIRPFiles(e){let t=this.app.vault.getMarkdownFiles(),s=[],n=!1,l=`${e}.md`,o=new RegExp(`^${e}/.+.md$`);return t.map(r=>{o.test(r.path)?s.push(r.path):r.path===l&&(n=!0)}),s.length===0&&n?s.push(l):n&&s.length!==0&&this.logs.push("ListItemRandmPicker","getLIRPFiles","folderAndFile"),s}async loadLIRPFiles(){let e=this.getLIRPFiles(this.settings.notePath),t=new F(this.settings.nullValue,this.settings.escapeValue,this.settings.commentValue,this.settings.maxReferenceDepth);for(let s of e){let n=this.app.vault.getAbstractFileByPath(s),l="";n instanceof g.TFile&&(l=await this.app.vault.cachedRead(n),t.loadFromNote(n.path.slice(0,-3),l))}return t}async prepareAction(e){let t=await this.loadLIRPFiles();t.length===0&&this.logs.push("ListItemRandomPicker","loadLIRPFiles","pathSetting"),!t.hasErrors()&&t.length!==0&&(e==="doRefSubstitution"?this.doReferenceSubstitution(t):t.length===1||!this.settings.showNoteSelector?new N(this.app,t.getListSuggestion(e==="reference"),s=>{e==="note"?this.workWithTitle(t,s.title):this.insertString(`{${s.title}}`)}).open():new N(this.app,t.getNoteSuggestion(e==="reference"),s=>{new N(this.app,t.getListSuggestion(e==="reference").filterByNoteName(s.noteName),n=>{e==="note"?this.workWithTitle(t,n.title):this.insertString(`{${n.title}}`)}).open()}).open()),this.doLogManagement(t.getLogs()),this.logs.flush(),t.flushLogs()}doLogManagement(e){let t=this.logs;e!==void 0&&(t.add(e),e.flush());let s=[],n=[],l=[];t.logs.map(o=>{switch(o.status){case"dupInNote":n.push(`List "${o.child}" is duplicate in note "${o.father}". List is ignored`);break;case"dupInFolder":s.push(`ERROR : List "${o.child}" exists in two notes, "${o.father}" and "${o.complement}", make correction !`);break;case"emptyList":n.push(`List "${o.child}" is empty in "${o.father}"`);break;case"emptyNote":n.push(`"${o.child}" is empty`);break;case"refLimit":n.push(`Reference depth limit reach with list "${o.child}" in note "${o.father}"`);break;case"pathSetting":s.push("ERROR : verify path in plugin settings");break;case"folderAndFile":n.push("A note with the same name as the folder in settings gets ignored.");break;case"showItem":l.push(`${o.complement}`);break;case"noActiveView":n.push("No note in edition mode to do this action");break}s.map(r=>new g.Notice(r)),this.settings.showWarning&&n.map(r=>new g.Notice(r)),l.map(r=>new g.Notice(r))}),this.logs.flush()}workWithTitle(e,t){let s=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(s){let n=`^${this.settings.selectionForNotification}$`,l=new RegExp(n),o=s.editor.getSelection();if(l.test(o))this.logs.push("","","showItem",e.pickRandomItemFromList(t)),this.settings.deleteSelectionForNotification&&s.editor.replaceSelection("");else{let r="",c=/^(\d+)(.*)/gm,p,w;if((p=c.exec(o))!==null){let m=Number(p[1]),a=o.replace(/^\d+/,""),u=[];for(let d=0;d<m;d++)u.push(e.pickRandomItemFromList(t));r=u.join(a)}else r=e.pickRandomItemFromList(t);s.editor.replaceSelection(r)}}else this.logs.push("ListItemRandomPicker","workWithTitle","noActiveView");this.doLogManagement(e.getLogs())}doReferenceSubstitution(e){let t=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(t){let s=t.editor.getSelection();t.editor.replaceSelection(e.doReferenceSubstitution(s))}else this.logs.push("ListItemRandomPicker","workWithTitle","noActiveView")}insertString(e){let t=this.app.workspace.getActiveViewOfType(g.MarkdownView);t?t.editor.replaceSelection(e):this.logs.push("ListItemRandomPicker","workWithTitle","noActiveView"),this.doLogManagement()}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},y=class extends g.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new g.Setting(e).setName("Path").setDesc('The path of a note or folder. Example: "Folder/Note" or "Folder".').addText(t=>t.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async s=>{this.plugin.settings.notePath=s,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Specific values"}),new g.Setting(e).setName("Null value").setDesc("If the first line of a list item has this value, that line is ignored. This allows you to have probabilities of getting no result. Usage example: having, or not having, a particle in a noun.").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.nullValue).onChange(async s=>{this.plugin.settings.nullValue=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Escape value").setDesc("To include heading one elements or first-level list items in your random list, escape them with these values. Exemple : // # Heading").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.escapeValue).onChange(async s=>{this.plugin.settings.escapeValue=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Selection value for notification").setDesc("If the selected text has this value, the item is not inserted; instead, a notification is shown.").addText(t=>t.setPlaceholder("Enter value").setValue(this.plugin.settings.selectionForNotification).onChange(async s=>{this.plugin.settings.selectionForNotification=s,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Behavior"}),new g.Setting(e).setName("Show note selector").setDesc("If path is a folder containing at least two notes, a selector will allow you to choose the note; otherwise, all lists will be offered to you.").addToggle(t=>{t.setValue(this.plugin.settings.showNoteSelector),t.onChange(async s=>{this.plugin.settings.showNoteSelector=s,await this.plugin.saveSettings()})}),new g.Setting(e).setName("Show warning").setDesc("Are warnings displayed as notifications ?").addToggle(t=>{t.setValue(this.plugin.settings.showWarning),t.onChange(async s=>{this.plugin.settings.showWarning=s,await this.plugin.saveSettings()})}),new g.Setting(e).setName("Delete selection value on notification").setDesc("If this setting is on, the selected notification value is removed after it's used.").addToggle(t=>{t.setValue(this.plugin.settings.deleteSelectionForNotification),t.onChange(async s=>{this.plugin.settings.deleteSelectionForNotification=s,await this.plugin.saveSettings()})}),new g.Setting(e).setName("Reference depth limit").setDesc("Reference recursion limit: the maximum number of nested reference calls allowed. Zero disables reference resolution.").addSlider(t=>t.setValue(this.plugin.settings.maxReferenceDepth).setLimits(0,10,1).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxReferenceDepth=s,await this.plugin.saveSettings()}))}};
