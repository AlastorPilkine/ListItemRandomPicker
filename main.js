/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  MySuggestModal: () => MySuggestModal,
  default: () => ListItemRandomPicker
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  notePath: "Full path of a note"
};
var MySuggestModal = class extends import_obsidian.SuggestModal {
  constructor(app, items, callback) {
    super(app);
    this.items = items;
    this.callback = callback;
  }
  getSuggestions(query) {
    return this.items.filter(
      (item) => item.title.toLowerCase().includes(query.toLowerCase())
    );
  }
  renderSuggestion(item, el) {
    el.createEl("div", { text: item.title });
  }
  onChooseSuggestion(item, evt) {
    this.callback(item.title);
  }
};
var ListItemRandomPicker = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("list-tree", "Pick random list item", (evt) => {
      this.openTitlePicker(this.settings.notePath);
    });
    this.addSettingTab(new LIRPSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  transformerEnSuggestions(strings) {
    return strings.map((str) => ({
      title: str,
      description: ""
    }));
  }
  async openTitlePicker(notePath) {
    const fullNotePath = notePath + ".md";
    const file = this.app.vault.getAbstractFileByPath(fullNotePath);
    if (!file) {
      new import_obsidian.Notice("Note not found!");
      return;
    }
    if (!(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice("Invalid file type. Expected a TFile.");
      return;
    }
    const content = await this.app.vault.read(file);
    const titles = this.getTitlesFromNote(content);
    if (titles.length === 0) {
      new import_obsidian.Notice("No titles found in the note!");
      return;
    }
    new MySuggestModal(this.app, this.transformerEnSuggestions(titles), (title) => {
      this.insertRandomEntry(content, title);
    }).open();
  }
  getTitlesFromNote(content) {
    const titleRegex = /^#+\s+(.+)$/gm;
    const titles = [];
    let match;
    while ((match = titleRegex.exec(content)) !== null) {
      titles.push(match[1]);
    }
    return titles;
  }
  async insertRandomEntry(content, title) {
    const entries = this.getEntriesFromNote(content, title);
    if (entries.length === 0) {
      new import_obsidian.Notice("No entries found for this title!");
      return;
    }
    const randomEntry = entries[Math.floor(Math.random() * entries.length)].replace(/\n/g, "");
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (activeView) {
      const editor = activeView.editor;
      const selection = editor.getSelection();
      editor.replaceSelection(randomEntry);
    } else {
      new import_obsidian.Notice("No active Markdown editor found.");
    }
  }
  getEntriesFromNote(content, title) {
    const titleRegex = new RegExp(`^#+\\s+${title}$`, "m");
    const titleMatch = titleRegex.exec(content);
    if (!titleMatch) {
      return [];
    }
    const startIndex = titleMatch.index + titleMatch[0].length;
    let endIndex = content.indexOf("\n#", startIndex);
    if (endIndex === -1) {
      endIndex = content.length;
    }
    const listItemRegex = /^(-|\d+\.) +(.+)$/gm;
    const entries = [];
    let currentEntry;
    let currentEntrySplit;
    let repeat;
    let itemString;
    const listContent = content.substring(startIndex, endIndex);
    while ((currentEntry = listItemRegex.exec(listContent)) !== null) {
      let fullString = currentEntry[2];
      const itemWithNumberRegEx = /^\((\d+)\)\s+(.+)$/m;
      if ((currentEntrySplit = itemWithNumberRegEx.exec(fullString)) !== null) {
        repeat = Number(currentEntrySplit[1]);
        itemString = currentEntrySplit[2];
      } else {
        repeat = 1;
        itemString = fullString;
      }
      for (let i = 0; i < repeat; i++) {
        entries.push(itemString);
      }
    }
    return entries;
  }
};
var LIRPSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Note Path").setDesc("Path to the note containing the lists.").addText((text) => text.setPlaceholder("Enter the path to your note").setValue(this.plugin.settings.notePath).onChange(async (value) => {
      this.plugin.settings.notePath = value;
      await this.plugin.saveSettings();
    }));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBNb2RhbCwgU3VnZ2VzdE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcblxuaW50ZXJmYWNlIExJUlBQbHVnaW5TZXR0aW5ncyB7XG4gICAgbm90ZVBhdGg6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTElSUFBsdWdpblNldHRpbmdzID0ge1xuICAgIG5vdGVQYXRoOiAnRnVsbCBwYXRoIG9mIGEgbm90ZSdcbn07XG5cbmludGVyZmFjZSBMSVJQTGlzdEludGVyZmFjZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGhpZGRlbjogYm9vbGVhbjtcbiAgICBpdGVtczogc3RyaW5nW107XG4gICAgcGlja1JhbmRvbUl0ZW0oKTogc3RyaW5nO1xufVxuXG5jbGFzcyBMSVJQTGlzdCBpbXBsZW1lbnRzIExJUlBMaXN0SW50ZXJmYWNlIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgaGlkZGVuOiBib29sZWFuO1xuICAgIGl0ZW1zOiBzdHJpbmdbXTtcblxuICAgIGNvbnN0cnVjdG9yKG11bHRpTGluZVN0cmluZzogc3RyaW5nKSB7XG4gICAgICAgIC8vIFdvcmsgdG8gZG9cbiAgICB9XG5cbiAgICBwaWNrUmFuZG9tSXRlbSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gXCJ0b3RvXCJcbiAgICB9XG5cbn1cbmludGVyZmFjZSBMSVJQTm90ZUludGVyZmFjZSB7XG4gICAgZnVsbFBhdGg6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGxpc3Q6IExJUlBMaXN0W107XG4gICAgbG9hZEZyb21Ob3RlKG5vdGVGdWxsUGF0aDogc3RyaW5nKTogYm9vbGVhbjtcbiAgICBnZXRMaXN0U3VnZ2VzdGlvbigpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdO1xuICAgIHBpY2tSYW5kb21JdGVtRnJvbUxpc3QobGlzdFRpdGxlOiBzdHJpbmcpOiBzdHJpbmc7IFxufVxuXG5jbGFzcyBMSVJQTm90ZSBpbXBsZW1lbnRzIExJUlBOb3RlSW50ZXJmYWNlIHtcbiAgICBmdWxsUGF0aDogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgbGlzdDogTElSUExpc3RbXTtcblxuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgICAgdGhpcy5mdWxsUGF0aCA9IFwiXCI7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBcIlwiO1xuICAgICAgICB0aGlzLmxpc3QgPSBbXTtcbiAgICB9XG5cbiAgICBsb2FkRnJvbU5vdGUobm90ZUZ1bGxQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBnZXRMaXN0U3VnZ2VzdGlvbigpOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdIHtcbiAgICAgICAgY29uc3QgZXhlbXBsZSA9IHtcbiAgICAgICAgICAgIHRpdGxlOiBcInRvdG9cIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlwiXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFycmF5ID0gW2V4ZW1wbGVdO1xuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuXG4gICAgcGlja1JhbmRvbUl0ZW1Gcm9tTGlzdChsaXN0VGl0bGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBcInRvdG9cIlxuICAgIH0gXG5cbn1cbmludGVyZmFjZSBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xufVxuXG5cbmV4cG9ydCBjbGFzcyBNeVN1Z2dlc3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxMSVJQU3VnZ2VzdGlvbkludGVyZmFjZT4ge1xuICAgIGl0ZW1zOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdO1xuICAgIGNhbGxiYWNrOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZDtcbiAgXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGl0ZW1zOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdLCBjYWxsYmFjazogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgICAgIHN1cGVyKGFwcCk7XG4gICAgICB0aGlzLml0ZW1zID0gaXRlbXM7XG4gICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgZ2V0U3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5pdGVtcy5maWx0ZXIoKGl0ZW0pID0+XG4gICAgICAgICAgaXRlbS50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgXG4gICAgcmVuZGVyU3VnZ2VzdGlvbihpdGVtOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZSwgZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGVsLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6IGl0ZW0udGl0bGUgfSk7XG4gICAgICB9XG4gIFxuICAgICAgb25DaG9vc2VTdWdnZXN0aW9uKGl0ZW06IExJUlBTdWdnZXN0aW9uSW50ZXJmYWNlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2soaXRlbS50aXRsZSk7XG4gICAgICB9fSAgXG5cbmNsYXNzIEl0ZW1QaWNrZXJNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBpdGVtczogc3RyaW5nW107XG4gICAgY2FsbGJhY2s6IChpdGVtOiBzdHJpbmcpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgaXRlbXM6IHN0cmluZ1tdLCBjYWxsYmFjazogKGl0ZW06IHN0cmluZykgPT4gdm9pZCkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLml0ZW1zID0gaXRlbXM7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgICAgIC8vIENvbmZpZ3VyYXRpb24gZHUgY29udGVuZXVyIEZsZXhib3hcbiAgICAgICAgY29udGVudEVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgIGNvbnRlbnRFbC5zdHlsZS5mbGV4RGlyZWN0aW9uID0gJ2NvbHVtbic7XG4gICAgICAgIGNvbnRlbnRFbC5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7IC8vIEFzc3VyZXotdm91cyBxdWUgbGUgY29udGVuZXVyIHByZW5kIHRvdXRlIGxhIGhhdXRldXJcblxuICAgICAgICAvLyBDb250ZW5ldXIgcG91ciBsZSBzXHUwMEU5bGVjdGV1ciAocHJlbmRyYSBsJ2VzcGFjZSByZXN0YW50KVxuICAgICAgICBjb25zdCBzZWxlY3RDb250YWluZXIgPSBjb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICAgIHNlbGVjdENvbnRhaW5lci5zdHlsZS5mbGV4R3JvdyA9ICcxJzsgLy8gUHJlbmQgbCdlc3BhY2UgZGlzcG9uaWJsZVxuICAgICAgICBzZWxlY3RDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgc2VsZWN0Q29udGFpbmVyLnN0eWxlLmZsZXhEaXJlY3Rpb24gPSAnY29sdW1uJztcbiAgICAgICAgc2VsZWN0Q29udGFpbmVyLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ2NlbnRlcic7IC8vIENlbnRyZSB2ZXJ0aWNhbGVtZW50IGxlIHNlbGVjdFxuICAgICAgICBzZWxlY3RDb250YWluZXIuc3R5bGUuYWxpZ25JdGVtcyA9ICdjZW50ZXInOyAvLyBDZW50cmUgaG9yaXpvbnRhbGVtZW50IGxlIHNlbGVjdFxuXG4gICAgICAgIGNvbnN0IGl0ZW1TZWxlY3QgPSBzZWxlY3RDb250YWluZXIuY3JlYXRlRWwoJ3NlbGVjdCcpO1xuICAgICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpdGVtU2VsZWN0LmNyZWF0ZUVsKCdvcHRpb24nLCB7IHZhbHVlOiBpdGVtLCB0ZXh0OiBpdGVtIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDb250ZW5ldXIgcG91ciBsZSBib3V0b24gKGVuIGJhcywgY2VudHJcdTAwRTkpXG4gICAgICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgYnV0dG9uQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgIGJ1dHRvbkNvbnRhaW5lci5zdHlsZS5qdXN0aWZ5Q29udGVudCA9ICdjZW50ZXInOyAvLyBDZW50cmUgaG9yaXpvbnRhbGVtZW50IGxlIGJvdXRvblxuICAgICAgICBidXR0b25Db250YWluZXIuc3R5bGUucGFkZGluZyA9ICcxMHB4IDAnOyAvLyBBam91dGUgdW4gcGV1IGQnZXNwYWNlIGF1dG91ciBkdSBib3V0b25cblxuICAgICAgICBjb25zdCBva0J1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbCgnYnV0dG9uJywgeyB0ZXh0OiAnT0snIH0pO1xuICAgICAgICBva0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkSXRlbSA9IGl0ZW1TZWxlY3QudmFsdWU7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrKHNlbGVjdGVkSXRlbSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uQ2xvc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExpc3RJdGVtUmFuZG9tUGlja2VyIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBzZXR0aW5nczogTElSUFBsdWdpblNldHRpbmdzO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgICAgIHRoaXMuYWRkUmliYm9uSWNvbignbGlzdC10cmVlJywgJ1BpY2sgcmFuZG9tIGxpc3QgaXRlbScsIChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMub3BlblRpdGxlUGlja2VyKHRoaXMuc2V0dGluZ3Mubm90ZVBhdGgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IExJUlBTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgfVxuXG4gICAgb251bmxvYWQoKSB7XG5cbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG5cbiAgICB0cmFuc2Zvcm1lckVuU3VnZ2VzdGlvbnMoc3RyaW5nczogc3RyaW5nW10pOiBMSVJQU3VnZ2VzdGlvbkludGVyZmFjZVtdIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ3MubWFwKHN0ciA9PiAoe1xuICAgICAgICAgIHRpdGxlOiBzdHIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiXCJcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgXG4gICAgYXN5bmMgb3BlblRpdGxlUGlja2VyKG5vdGVQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgZnVsbE5vdGVQYXRoID0gbm90ZVBhdGggKyAnLm1kJztcbiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmdWxsTm90ZVBhdGgpO1xuXG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm90ZSBub3QgZm91bmQhJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdJbnZhbGlkIGZpbGUgdHlwZS4gRXhwZWN0ZWQgYSBURmlsZS4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICBjb25zdCB0aXRsZXMgPSB0aGlzLmdldFRpdGxlc0Zyb21Ob3RlKGNvbnRlbnQpO1xuXG4gICAgICAgIGlmICh0aXRsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdObyB0aXRsZXMgZm91bmQgaW4gdGhlIG5vdGUhJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbmV3IE15U3VnZ2VzdE1vZGFsKHRoaXMuYXBwLCB0aGlzLnRyYW5zZm9ybWVyRW5TdWdnZXN0aW9ucyh0aXRsZXMpLCAodGl0bGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0UmFuZG9tRW50cnkoY29udGVudCwgdGl0bGUpO1xuICAgICAgICB9KS5vcGVuKCk7XG4gICAgICAgIFxuXG4gICAgICAgIC8vIG5ldyBJdGVtUGlja2VyTW9kYWwodGhpcy5hcHAsIHRpdGxlcywgKHRpdGxlKSA9PiB7XG4gICAgICAgIC8vICAgICB0aGlzLmluc2VydFJhbmRvbUVudHJ5KGNvbnRlbnQsIHRpdGxlKTtcbiAgICAgICAgLy8gfSkub3BlbigpO1xuICAgIH1cblxuICAgIGdldFRpdGxlc0Zyb21Ob3RlKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgdGl0bGVSZWdleCA9IC9eIytcXHMrKC4rKSQvZ207XG4gICAgICAgIGNvbnN0IHRpdGxlczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICB3aGlsZSAoKG1hdGNoID0gdGl0bGVSZWdleC5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGl0bGVzLnB1c2gobWF0Y2hbMV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aXRsZXM7XG4gICAgfVxuXG4gICAgYXN5bmMgaW5zZXJ0UmFuZG9tRW50cnkoY29udGVudDogc3RyaW5nLCB0aXRsZTogc3RyaW5nKSB7XG5cbiAgICAgICAgY29uc3QgZW50cmllcyA9IHRoaXMuZ2V0RW50cmllc0Zyb21Ob3RlKGNvbnRlbnQsIHRpdGxlKTtcblxuICAgICAgICBpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIGVudHJpZXMgZm91bmQgZm9yIHRoaXMgdGl0bGUhJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZG9tRW50cnkgPSBlbnRyaWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVudHJpZXMubGVuZ3RoKV0ucmVwbGFjZSgvXFxuL2csICcnKTtcbiAgICAgICAgLy8gY29uc3QgcmFuZG9tRW50cnkgPSBlbnRyaWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVudHJpZXMubGVuZ3RoKV0udHJpbSgpO1xuXG4gICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuXG4gICAgICAgIGlmIChhY3RpdmVWaWV3KSB7XG4gICAgICAgICAgICBjb25zdCBlZGl0b3IgPSBhY3RpdmVWaWV3LmVkaXRvcjtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKHJhbmRvbUVudHJ5KTtcbiAgICAgICAgICAgIC8vIGNvbnN0IHBvc2l0aW9uID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgICAgICAgLy8gZWRpdG9yLnJlcGxhY2VSYW5nZShyYW5kb21FbnRyeSwgcG9zaXRpb24pOyAvLywgcG9zaXRpb24pO1xuXG4gICAgICAgICAgICAvLyAvLyBEXHUwMEU5cGxhY2VyIGxlIGN1cnNldXIgXHUwMEUwIGxhIGZpbiBkZSBsJ2luc2VydGlvblxuICAgICAgICAgICAgLy8gY29uc3QgbmV3UG9zaXRpb24gPSB7IGxpbmU6IHBvc2l0aW9uLmxpbmUsIGNoOiBwb3NpdGlvbi5jaCArIHJhbmRvbUVudHJ5Lmxlbmd0aCB9O1xuICAgICAgICAgICAgLy8gZWRpdG9yLnNldEN1cnNvcihuZXdQb3NpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFwiTm8gYWN0aXZlIE1hcmtkb3duIGVkaXRvciBmb3VuZC5cIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRFbnRyaWVzRnJvbU5vdGUoY29udGVudDogc3RyaW5nLCB0aXRsZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCB0aXRsZVJlZ2V4ID0gbmV3IFJlZ0V4cChgXiMrXFxcXHMrJHt0aXRsZX0kYCwgJ20nKTtcbiAgICAgICAgY29uc3QgdGl0bGVNYXRjaCA9IHRpdGxlUmVnZXguZXhlYyhjb250ZW50KTtcblxuICAgICAgICBpZiAoIXRpdGxlTWF0Y2gpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSB0aXRsZU1hdGNoLmluZGV4ICsgdGl0bGVNYXRjaFswXS5sZW5ndGg7XG4gICAgICAgIGxldCBlbmRJbmRleCA9IGNvbnRlbnQuaW5kZXhPZignXFxuIycsIHN0YXJ0SW5kZXgpO1xuICAgICAgICBpZiAoZW5kSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICBlbmRJbmRleCA9IGNvbnRlbnQubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbGlzdEl0ZW1SZWdleCA9IC9eKC18XFxkK1xcLikgKyguKykkL2dtO1xuICAgICAgICBjb25zdCBlbnRyaWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBsZXQgY3VycmVudEVudHJ5O1xuICAgICAgICBsZXQgY3VycmVudEVudHJ5U3BsaXQ7XG4gICAgICAgIGxldCByZXBlYXQ6IG51bWJlcjtcbiAgICAgICAgbGV0IGl0ZW1TdHJpbmc6IHN0cmluZztcbiAgICAgICAgY29uc3QgbGlzdENvbnRlbnQgPSBjb250ZW50LnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7XG4gICAgICAgIHdoaWxlICgoY3VycmVudEVudHJ5ID0gbGlzdEl0ZW1SZWdleC5leGVjKGxpc3RDb250ZW50KSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBmdWxsU3RyaW5nID0gY3VycmVudEVudHJ5WzJdO1xuICAgICAgICAgICAgY29uc3QgaXRlbVdpdGhOdW1iZXJSZWdFeCA9IC9eXFwoKFxcZCspXFwpXFxzKyguKykkL207XG4gICAgICAgICAgICBpZiAoKGN1cnJlbnRFbnRyeVNwbGl0ID0gaXRlbVdpdGhOdW1iZXJSZWdFeC5leGVjKGZ1bGxTdHJpbmcpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJlcGVhdCA9IE51bWJlcihjdXJyZW50RW50cnlTcGxpdFsxXSk7XG4gICAgICAgICAgICAgICAgaXRlbVN0cmluZyA9IGN1cnJlbnRFbnRyeVNwbGl0WzJdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXBlYXQgPSAxO1xuICAgICAgICAgICAgICAgIGl0ZW1TdHJpbmcgPSBmdWxsU3RyaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXBlYXQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaChpdGVtU3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW50cmllcztcbiAgICB9XG59XG5cbmNsYXNzIExJUlBTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBMaXN0SXRlbVJhbmRvbVBpY2tlcjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IExpc3RJdGVtUmFuZG9tUGlja2VyKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcblxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgICAgIC8vIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ1NldHRpbmdzIGZvciBMaXN0IEl0ZW0gUmFuZG9tIFBpY2tlci4nIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ05vdGUgUGF0aCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnUGF0aCB0byB0aGUgbm90ZSBjb250YWluaW5nIHRoZSBsaXN0cy4nKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFbnRlciB0aGUgcGF0aCB0byB5b3VyIG5vdGUnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ub3RlUGF0aClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm5vdGVQYXRoID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICB9XG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQXlHO0FBTXpHLElBQU0sbUJBQXVDO0FBQUEsRUFDekMsVUFBVTtBQUNkO0FBcUVPLElBQU0saUJBQU4sY0FBNkIsNkJBQXNDO0FBQUEsRUFJdEUsWUFBWSxLQUFVLE9BQWtDLFVBQW1DO0FBQ3pGLFVBQU0sR0FBRztBQUNULFNBQUssUUFBUTtBQUNiLFNBQUssV0FBVztBQUFBLEVBQ2xCO0FBQUEsRUFFQSxlQUFlLE9BQTBDO0FBQ3JELFdBQU8sS0FBSyxNQUFNO0FBQUEsTUFBTyxDQUFDLFNBQ3hCLEtBQUssTUFBTSxZQUFZLEVBQUUsU0FBUyxNQUFNLFlBQVksQ0FBQztBQUFBLElBQ3ZEO0FBQUEsRUFDRjtBQUFBLEVBRUYsaUJBQWlCLE1BQStCLElBQWlCO0FBQzdELE9BQUcsU0FBUyxPQUFPLEVBQUUsTUFBTSxLQUFLLE1BQU0sQ0FBQztBQUFBLEVBQ3pDO0FBQUEsRUFFQSxtQkFBbUIsTUFBK0IsS0FBaUM7QUFDakYsU0FBSyxTQUFTLEtBQUssS0FBSztBQUFBLEVBQzFCO0FBQUM7QUFxRFAsSUFBcUIsdUJBQXJCLGNBQWtELHVCQUFPO0FBQUEsRUFHckQsTUFBTSxTQUFTO0FBQ1gsVUFBTSxLQUFLLGFBQWE7QUFFeEIsU0FBSyxjQUFjLGFBQWEseUJBQXlCLENBQUMsUUFBb0I7QUFDMUUsV0FBSyxnQkFBZ0IsS0FB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
